<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Autonautics Smart Waste Management - Powered by AI</title>
    
    <!-- Font Awesome CDN with Multiple Fallbacks -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.4.0/css/all.css" crossorigin="anonymous">
    
    <!-- Enhanced Messaging System CSS -->
    <link rel="stylesheet" href="messaging-styles.css">
    
    <!-- Inline Font Awesome CSS Fallback for offline/CORS issues -->
    <style>
        /* Basic Font Awesome icon styles for fallback */
        .fas, .fa-solid { 
            font-family: 'Font Awesome 6 Free', sans-serif; 
            font-weight: 900; 
            display: inline-block;
            font-style: normal;
            font-variant: normal;
            text-rendering: auto;
            line-height: 1;
        }
        
        /* Comprehensive Fallback icons using Unicode symbols */
        .fa-chart-line::before { content: '📈'; }
        .fa-tachometer-alt::before { content: '⚡'; }
        .fa-crystal-ball::before { content: '🔮'; }
        .fa-cogs::before { content: '⚙️'; }
        .fa-leaf::before { content: '🌿'; }
        .fa-dollar-sign::before { content: '$'; }
        .fa-truck::before { content: '🚛'; }
        .fa-user::before { content: '👤'; }
        .fa-map::before { content: '🗺️'; }
        .fa-bell::before { content: '🔔'; }
        .fa-home::before { content: '🏠'; }
        .fa-search::before { content: '🔍'; }
        
        /* Additional icons for driver and system functionality */
        .fa-cube::before { content: '📦'; }
        .fa-user-tie::before { content: '👔'; }
        .fa-user-shield::before { content: '🛡️'; }
        .fa-sign-in-alt::before { content: '🚪'; }
        .fa-sign-out-alt::before { content: '🚪'; }
        .fa-wrench::before { content: '🔧'; }
        .fa-info-circle::before { content: 'ℹ️'; }
        .fa-user-plus::before { content: '➕'; }
        .fa-satellite-dish::before { content: '📡'; }
        .fa-sync::before { content: '🔄'; }
        .fa-cloud-upload-alt::before { content: '☁️'; }
        .fa-route::before { content: '🛣️'; }
        .fa-trash::before { content: '🗑️'; }
        .fa-gas-pump::before { content: '⛽'; }
        .fa-star::before { content: '⭐'; }
        .fa-play-circle::before { content: '▶️'; }
        .fa-chevron-right::before { content: '►'; }
        .fa-chevron-left::before { content: '◄'; }
        .fa-chevron-down::before { content: '▼'; }
        .fa-chevron-up::before { content: '▲'; }
        .fa-times::before { content: '❌'; }
        .fa-check::before { content: '✅'; }
        .fa-plus::before { content: '➕'; }
        .fa-minus::before { content: '➖'; }
        .fa-edit::before { content: '✏️'; }
        .fa-trash-alt::before { content: '🗑️'; }
        .fa-eye::before { content: '👁️'; }
        .fa-download::before { content: '⬇️'; }
        .fa-upload::before { content: '⬆️'; }
        .fa-calendar::before { content: '📅'; }
        .fa-clock::before { content: '🕒'; }
        .fa-location-arrow::before { content: '📍'; }
        .fa-map-marker-alt::before { content: '📍'; }
        .fa-phone::before { content: '📞'; }
        .fa-envelope::before { content: '✉️'; }
        .fa-warning::before { content: '⚠️'; }
        .fa-exclamation-triangle::before { content: '⚠️'; }
        .fa-exclamation-circle::before { content: '❗'; }
        
        /* AI/ML and Analytics Specific Icons */
        .fa-brain::before { content: '🧠'; }
        .fa-robot::before { content: '🤖'; }
        .fa-microchip::before { content: '🔬'; }
        .fa-network-wired::before { content: '🌐'; }
        .fa-database::before { content: '🗄️'; }
        .fa-server::before { content: '🖥️'; }
        .fa-chart-bar::before { content: '📊'; }
        .fa-chart-pie::before { content: '🥧'; }
        .fa-chart-area::before { content: '📈'; }
        .fa-analytics::before { content: '📊'; }
        .fa-lightbulb::before { content: '💡'; }
        .fa-atom::before { content: '⚛️'; }
        .fa-flask::before { content: '🧪'; }
        .fa-microscope::before { content: '🔬'; }
        .fa-cpu::before { content: '⚙️'; }
        .fa-memory::before { content: '💾'; }
        
        /* Navigation and UI Icons */
        .fa-city::before { content: '🏙️'; }
        .fa-users::before { content: '👥'; }
        .fa-smile::before { content: '😊'; }
        .fa-frown::before { content: '😞'; }
        .fa-meh::before { content: '😐'; }
        .fa-history::before { content: '⏰'; }
        .fa-qrcode::before { content: '⬜'; }
        .fa-coffee::before { content: '☕'; }
        .fa-power-off::before { content: '⏻'; }
        .fa-settings::before { content: '⚙️'; }
        .fa-gear::before { content: '⚙️'; }
        
        /* Status and Action Icons */
        .fa-check-circle::before { content: '✅'; }
        .fa-times-circle::before { content: '❌'; }
        .fa-play::before { content: '▶️'; }
        .fa-pause::before { content: '⏸️'; }
        .fa-stop::before { content: '⏹️'; }
        .fa-refresh::before { content: '🔄'; }
        .fa-sync-alt::before { content: '🔄'; }
        .fa-undo::before { content: '↶'; }
        .fa-redo::before { content: '↷'; }
        .fa-save::before { content: '💾'; }
        .fa-print::before { content: '🖨️'; }
        .fa-share::before { content: '📤'; }
        .fa-copy::before { content: '📋'; }
        .fa-cut::before { content: '✂️'; }
        .fa-paste::before { content: '📋'; }
        
        /* Map and Location Icons */
        .fa-map-marked-alt::before { content: '🗺️'; }
        .fa-compass::before { content: '🧭'; }
        .fa-directions::before { content: '🧭'; }
        .fa-gps::before { content: '📍'; }
        .fa-marker::before { content: '📌'; }
        .fa-flag::before { content: '🚩'; }
        .fa-flag-checkered::before { content: '🏁'; }
        
        /* Data and Analytics Icons */
        .fa-table::before { content: '📋'; }
        .fa-list::before { content: '📝'; }
        .fa-th::before { content: '⊞'; }
        .fa-th-large::before { content: '▦'; }
        .fa-th-list::before { content: '☰'; }
        .fa-filter::before { content: '🔍'; }
        .fa-sort::before { content: '⇅'; }
        .fa-sort-up::before { content: '⇈'; }
        .fa-sort-down::before { content: '⇊'; }
        
        /* System and Technical Icons */
        .fa-terminal::before { content: '💻'; }
        .fa-code::before { content: '<>'; }
        .fa-bug::before { content: '🐛'; }
        .fa-shield-alt::before { content: '🛡️'; }
        .fa-lock::before { content: '🔒'; }
        .fa-unlock::before { content: '🔓'; }
        .fa-key::before { content: '🗝️'; }
        .fa-wifi::before { content: '📶'; }
        .fa-signal::before { content: '📶'; }
        .fa-battery-full::before { content: '🔋'; }
        .fa-battery-half::before { content: '🔋'; }
        .fa-battery-empty::before { content: '🪫'; }
        
        /* Communication Icons */
        .fa-comments::before { content: '💬'; }
        .fa-comment::before { content: '💭'; }
        .fa-message::before { content: '💌'; }
        .fa-inbox::before { content: '📥'; }
        .fa-outbox::before { content: '📤'; }
        
        /* Media and Control Icons */
        .fa-volume-up::before { content: '🔊'; }
        .fa-volume-down::before { content: '🔉'; }
        .fa-volume-mute::before { content: '🔇'; }
        .fa-image::before { content: '🖼️'; }
        .fa-video::before { content: '📹'; }
        .fa-camera::before { content: '📷'; }
        
        /* Weather and Environment Icons */
        .fa-sun::before { content: '☀️'; }
        .fa-moon::before { content: '🌙'; }
        .fa-cloud::before { content: '☁️'; }
        .fa-rain::before { content: '🌧️'; }
        .fa-snow::before { content: '❄️'; }
        .fa-wind::before { content: '💨'; }
        .fa-temperature-high::before { content: '🌡️'; }
        .fa-temperature-low::before { content: '🧊'; }
        
        /* Transportation Icons */
        .fa-car::before { content: '🚗'; }
        .fa-bus::before { content: '🚌'; }
        .fa-motorcycle::before { content: '🏍️'; }
        .fa-bicycle::before { content: '🚲'; }
        .fa-plane::before { content: '✈️'; }
        .fa-ship::before { content: '🚢'; }
        .fa-train::before { content: '🚆'; }
        
        /* Business and Finance Icons */
        .fa-coins::before { content: '🪙'; }
        .fa-credit-card::before { content: '💳'; }
        .fa-wallet::before { content: '👛'; }
        .fa-receipt::before { content: '🧾'; }
        .fa-calculator::before { content: '🧮'; }
        .fa-chart-growth::before { content: '📈'; }
        .fa-trending-up::before { content: '📈'; }
        .fa-trending-down::before { content: '📉'; }
        
        /* Document and File Icons */
        .fa-file-pdf::before { content: '📄'; }
        .fa-file-csv::before { content: '📊'; }
        .fa-file-alt::before { content: '📝'; }
        .fa-file::before { content: '📄'; }
        .fa-folder::before { content: '📁'; }
        .fa-archive::before { content: '🗃️'; }
        
        /* Missing AI Card Icons */
        .fa-cog::before { content: '⚙️'; }
        .fa-question-circle::before { content: '❓'; }
        .fa-trash-alt::before { content: '🗑️'; }
        .fa-fill-drip::before { content: '💧'; }
        .fa-arrow-right::before { content: '→'; }
        .fa-route-highway::before { content: '🛣️'; }
        .fa-road::before { content: '🛣️'; }
        .fa-stopwatch::before { content: '⏱️'; }
        .fa-leaf-oak::before { content: '🍃'; }
        .fa-seedling::before { content: '🌱'; }
        .fa-award::before { content: '🏆'; }
        .fa-medal::before { content: '🥇'; }
        .fa-bullseye::before { content: '🎯'; }
        .fa-crosshairs::before { content: '🎯'; }
        .fa-percentage::before { content: '%'; }
        .fa-thumbs-up::before { content: '👍'; }
        .fa-thumbs-down::before { content: '👎'; }
        .fa-eye-slash::before { content: '🙈'; }
        .fa-info::before { content: 'ℹ️'; }
        .fa-magic::before { content: '✨'; }
        .fa-wand-magic::before { content: '✨'; }
        .fa-sparkles::before { content: '✨'; }
        .fa-gem::before { content: '💎'; }
        .fa-crown::before { content: '👑'; }
        .fa-fire-alt::before { content: '🔥'; }
        .fa-rocket::before { content: '🚀'; }
        
        /* Additional AI Card Specific Icons */
        .fa-random::before { content: '🔀'; }
        .fa-shuffle::before { content: '🔀'; }
        .fa-exclamation::before { content: '❗'; }
        .fa-trophy::before { content: '🏆'; }
        .fa-arrow-down::before { content: '↓'; }
        .fa-arrow-up::before { content: '↑'; }
        .fa-text-success::before { content: '✅'; }
        .fa-text-warning::before { content: '⚠️'; }
        .fa-check-circle::before { content: '✅'; }
        .fa-map-marked-alt::before { content: '🗺️'; }
        .fa-history::before { content: '⏰'; }
        .fa-flask::before { content: '🧪'; }
        .fa-route::before { content: '🛣️'; }
        .fa-info-circle::before { content: 'ℹ️'; }
        
        /* Final missing icons for AI card */
        .fa-chevron-right::before { content: '▶️'; }
        .fa-gas-pump::before { content: '⛽'; }
        .fa-map-marker::before { content: '📍'; }
        .fa-sync::before { content: '🔄'; }
        .fa-user-plus::before { content: '👤➕'; }
        .fa-satellite-dish::before { content: '📡'; }
        
        /* Font Loading Detection for better fallback */
        @font-face {
            font-family: 'FontAwesome';
            src: url('data:font/woff2;base64,') format('woff2');
            font-display: swap;
        }
        
        /* Utility and Tool Icons */
        .fa-tools::before { content: '🛠️'; }
        .fa-hammer::before { content: '🔨'; }
        .fa-screwdriver::before { content: '🪛'; }
        .fa-bolt::before { content: '⚡'; }
        .fa-fire::before { content: '🔥'; }
        .fa-water::before { content: '💧'; }
        .fa-snowflake::before { content: '❄️'; }
        .fa-recycle::before { content: '♻️'; }
        .fa-magic::before { content: '✨'; }
        
        /* User and Identity Icons */
        .fa-user-check::before { content: '✅'; }
        .fa-user-cog::before { content: '⚙️'; }
        .fa-user-plus::before { content: '👤'; }
        .fa-id-card::before { content: '🪪'; }
        .fa-badge::before { content: '🏷️'; }
        
        /* Vehicle and Transportation Details */
        .fa-car::before { content: '🚗'; }
        .fa-weight::before { content: '⚖️'; }
        .fa-tachometer::before { content: '⚡'; }
        .fa-speedometer::before { content: '🏎️'; }
        
        /* Environment and Nature Icons */
        .fa-tree::before { content: '🌳'; }
        .fa-tint::before { content: '💧'; }
        .fa-droplet::before { content: '💧'; }
        .fa-seedling::before { content: '🌱'; }
        
        /* Arrow and Direction Icons */
        .fa-arrow-up::before { content: '⬆️'; }
        .fa-arrow-down::before { content: '⬇️'; }
        .fa-arrow-left::before { content: '⬅️'; }
        .fa-arrow-right::before { content: '➡️'; }
        .fa-arrow-circle-up::before { content: '🔝'; }
        .fa-arrow-circle-down::before { content: '🔽'; }
        
        /* Alert and Status Icons */
        .fa-circle::before { content: '⚫'; }
        .fa-dot-circle::before { content: '🔘'; }
        .fa-square::before { content: '⬛'; }
        .fa-heart::before { content: '❤️'; }
        .fa-thumbs-up::before { content: '👍'; }
        .fa-thumbs-down::before { content: '👎'; }
        .fa-like::before { content: '👍'; }
        .fa-dislike::before { content: '👎'; }
        
        /* Advanced System Icons */
        .fa-memory::before { content: '💾'; }
        .fa-hdd::before { content: '💿'; }
        .fa-ethernet::before { content: '🌐'; }
        .fa-plug::before { content: '🔌'; }
        .fa-power::before { content: '⚡'; }
        
        /* Additional Specialized Icons */
        .fa-magic-wand::before { content: '🪄'; }
        .fa-sparkles::before { content: '✨'; }
        .fa-crystal-ball::before { content: '🔮'; }
        .fa-atom::before { content: '⚛️'; }
        .fa-dna::before { content: '🧬'; }
        .fa-microscope::before { content: '🔬'; }
        
        /* Control and Media Icons */
        .fa-volume::before { content: '🔊'; }
        .fa-speaker::before { content: '🔈'; }
        .fa-microphone::before { content: '🎤'; }
        .fa-headphones::before { content: '🎧'; }
        
        /* Time and Calendar Extended */
        .fa-hourglass::before { content: '⏳'; }
        .fa-stopwatch::before { content: '⏱️'; }
        .fa-alarm-clock::before { content: '⏰'; }
        .fa-timer::before { content: '⏲️'; }
        .fa-calendar-check::before { content: '📅'; }
        .fa-calendar-alt::before { content: '📅'; }
        .fa-calendar-plus::before { content: '📅'; }
        .fa-calendar-minus::before { content: '📅'; }
        
        /* Additional Business Icons */
        .fa-briefcase::before { content: '💼'; }
        .fa-handshake::before { content: '🤝'; }
        .fa-presentation::before { content: '📊'; }
        .fa-meeting::before { content: '🤝'; }
        
        /* Navigation and Layout Icons */
        .fa-th-large::before { content: '▦'; }
        .fa-th::before { content: '⊞'; }
        .fa-th-list::before { content: '☰'; }
        .fa-bars::before { content: '☰'; }
        .fa-ellipsis-v::before { content: '⋮'; }
        .fa-ellipsis-h::before { content: '⋯'; }
        .fa-menu::before { content: '☰'; }
        .fa-hamburger::before { content: '☰'; }
        
        /* Additional Specialized Icons for AI/ML/Analytics */
        .fa-flask-vial::before { content: '🧪'; }
        .fa-test-tube::before { content: '🧪'; }
        .fa-laboratory::before { content: '🔬'; }
        .fa-science::before { content: '⚗️'; }
        .fa-research::before { content: '🔬'; }
        .fa-experiment::before { content: '🧪'; }
        .fa-algorithm::before { content: '⚙️'; }
        .fa-neural-network::before { content: '🧠'; }
        .fa-artificial-intelligence::before { content: '🤖'; }
        .fa-machine-learning::before { content: '🔬'; }
        .fa-deep-learning::before { content: '🧠'; }
        .fa-data-science::before { content: '📊'; }
        .fa-statistics::before { content: '📈'; }
        .fa-metrics::before { content: '📊'; }
        .fa-insights::before { content: '💡'; }
        .fa-optimization::before { content: '⚙️'; }
        .fa-efficiency::before { content: '⚡'; }
        .fa-performance::before { content: '🚀'; }
        .fa-automation::before { content: '🤖'; }
        .fa-intelligence::before { content: '🧠'; }
        .fa-prediction::before { content: '🔮'; }
        .fa-forecasting::before { content: '📈'; }
        .fa-analytics::before { content: '📊'; }
        .fa-dashboard::before { content: '📊'; }
        .fa-monitoring::before { content: '📡'; }
        .fa-surveillance::before { content: '👁️'; }
        .fa-tracking::before { content: '📍'; }
        
        /* Additional System and Technical Icons */
        .fa-api::before { content: '🔗'; }
        .fa-json::before { content: '📄'; }
        .fa-xml::before { content: '📄'; }
        .fa-csv::before { content: '📊'; }
        .fa-export::before { content: '📤'; }
        .fa-import::before { content: '📥'; }
        .fa-backup::before { content: '💾'; }
        .fa-restore::before { content: '↺'; }
        .fa-version::before { content: '🏷️'; }
        .fa-update::before { content: '🔄'; }
        .fa-upgrade::before { content: '⬆️'; }
        .fa-downgrade::before { content: '⬇️'; }
        
        /* IoT and Smart City Icons */
        .fa-sensor::before { content: '📡'; }
        .fa-iot::before { content: '🌐'; }
        .fa-smart-city::before { content: '🏙️'; }
        .fa-connected::before { content: '🔗'; }
        .fa-wireless::before { content: '📶'; }
        .fa-bluetooth::before { content: '📶'; }
        .fa-nfc::before { content: '📱'; }
        .fa-rfid::before { content: '📡'; }
        .fa-beacon::before { content: '📶'; }
        .fa-satellite::before { content: '🛰️'; }
        .fa-gps-tracker::before { content: '📍'; }
        .fa-geolocation::before { content: '🌍'; }
        
        /* Emergency and Safety Icons */
        .fa-emergency::before { content: '🚨'; }
        .fa-alert::before { content: '⚠️'; }
        .fa-siren::before { content: '🚨'; }
        .fa-first-aid::before { content: '🏥'; }
        .fa-medical::before { content: '⚕️'; }
        .fa-health::before { content: '❤️'; }
        .fa-safety::before { content: '🦺'; }
        .fa-helmet::before { content: '⛑️'; }
        .fa-shield::before { content: '🛡️'; }
        .fa-security::before { content: '🔒'; }
        .fa-surveillance-camera::before { content: '📹'; }
        .fa-cctv::before { content: '📹'; }
    </style>
    
    <!-- Load Leaflet CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.css" 
          onerror="this.onerror=null; this.href='https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';" />
    
    <!-- Try multiple CDN sources with fallbacks -->
    <script>
        // Load Chart.js with multiple fallback sources
        function loadChartJS() {
            const sources = [
                'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js',
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js'
            ];
            
            let sourceIndex = 0;
            
            function tryNextSource() {
                if (sourceIndex >= sources.length) {
                    console.warn('⚠️ All Chart.js sources failed, creating fallback');
                    createChartJSFallback();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = function() {
                    console.log('✅ Chart.js loaded from:', sources[sourceIndex]);
                };
                script.onerror = function() {
                    console.warn('❌ Failed to load Chart.js from:', sources[sourceIndex]);
                    sourceIndex++;
                    tryNextSource();
                };
                document.head.appendChild(script);
            }
            
            tryNextSource();
        }
        
        function createChartJSFallback() {
            // Create a basic Chart fallback object
            window.Chart = window.Chart || {
                register: function() {},
                defaults: { responsive: true },
                Chart: function(ctx, config) {
                    this.ctx = ctx;
                    this.config = config;
                    this.data = config.data || {};
                    this.options = config.options || {};
                    
                    // Create a simple fallback visualization
                    if (ctx && ctx.getContext) {
                        const canvas = ctx.getContext('2d');
                        canvas.fillStyle = '#e3f2fd';
                        canvas.fillRect(0, 0, ctx.width || 400, ctx.height || 200);
                        canvas.fillStyle = '#1976d2';
                        canvas.font = '16px Arial';
                        canvas.textAlign = 'center';
                        canvas.fillText('Chart: ' + (config.type || 'Data'), (ctx.width || 400)/2, (ctx.height || 200)/2);
                    }
                    
                    return {
                        update: function() {},
                        destroy: function() {},
                        data: this.data,
                        options: this.options
                    };
                }
            };
            
            // Create constructor aliases
            ['Bar', 'Line', 'Doughnut', 'Pie', 'Radar', 'PolarArea'].forEach(type => {
                window.Chart[type] = window.Chart.Chart;
            });
            
            console.log('📊 Chart.js fallback created');
        }
        
        // Load other libraries with fallbacks
        function loadLibraryWithFallback(sources, name, fallbackFn) {
            let sourceIndex = 0;
            
            function tryNext() {
                if (sourceIndex >= sources.length) {
                    console.warn(`⚠️ All ${name} sources failed`);
                    if (fallbackFn) fallbackFn();
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = () => console.log(`✅ ${name} loaded from:`, sources[sourceIndex]);
                script.onerror = () => {
                    console.warn(`❌ Failed to load ${name} from:`, sources[sourceIndex]);
                    sourceIndex++;
                    tryNext();
                };
                document.head.appendChild(script);
            }
            
            tryNext();
        }
        
        // Library loading status management
        let loadingStatus = {
            chartjs: false,
            leaflet: false,
            jspdf: false
        };
        
        function updateLoadingStatus(library, success) {
            loadingStatus[library] = success;
            const statusEl = document.getElementById('status-text');
            const statusContainer = document.getElementById('library-status');
            
            if (!statusEl || !statusContainer) return;
            
            const loaded = Object.values(loadingStatus).filter(Boolean).length;
            const total = Object.keys(loadingStatus).length;
            
            if (loaded === total) {
                statusEl.innerHTML = '✅ All libraries ready';
                statusEl.style.color = '#22c55e';
                setTimeout(() => {
                    statusContainer.style.opacity = '0';
                    setTimeout(() => statusContainer.style.display = 'none', 300);
                }, 2000);
            } else {
                const successCount = Object.entries(loadingStatus).filter(([lib, status]) => status).length;
                const failureCount = Object.entries(loadingStatus).filter(([lib, status]) => status === false && lib !== 'pending').length;
                
                if (failureCount > 0) {
                    statusEl.innerHTML = `⚠️ ${successCount}/${total} libraries loaded (${failureCount} using fallbacks)`;
                    statusEl.style.color = '#f59e0b';
                } else {
                    statusEl.innerHTML = `🔄 Loading libraries... (${loaded}/${total})`;
                    statusEl.style.color = '#3b82f6';
                }
            }
        }
        
        // Enhanced loadChartJS with status updates
        function loadChartJS() {
            const sources = [
                'https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.js',
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.js'
            ];
            
            let sourceIndex = 0;
            
            function tryNextSource() {
                if (sourceIndex >= sources.length) {
                    console.warn('⚠️ All Chart.js sources failed, creating fallback');
                    createChartJSFallback();
                    updateLoadingStatus('chartjs', 'fallback');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = function() {
                    console.log('✅ Chart.js loaded from:', sources[sourceIndex]);
                    updateLoadingStatus('chartjs', true);
                };
                script.onerror = function() {
                    console.warn('❌ Failed to load Chart.js from:', sources[sourceIndex]);
                    sourceIndex++;
                    tryNextSource();
                };
                document.head.appendChild(script);
            }
            
            tryNextSource();
        }
        
        // Enhanced library loader with status updates
        function loadLibraryWithFallback(sources, name, fallbackFn) {
            let sourceIndex = 0;
            
            function tryNext() {
                if (sourceIndex >= sources.length) {
                    console.warn(`⚠️ All ${name} sources failed`);
                    if (fallbackFn) fallbackFn();
                    updateLoadingStatus(name.toLowerCase(), 'fallback');
                    return;
                }
                
                const script = document.createElement('script');
                script.src = sources[sourceIndex];
                script.onload = () => {
                    console.log(`✅ ${name} loaded from:`, sources[sourceIndex]);
                    updateLoadingStatus(name.toLowerCase(), true);
                };
                script.onerror = () => {
                    console.warn(`❌ Failed to load ${name} from:`, sources[sourceIndex]);
                    sourceIndex++;
                    tryNext();
                };
                document.head.appendChild(script);
            }
            
            tryNext();
        }
        
        // Load all libraries with status tracking
        document.addEventListener('DOMContentLoaded', function() {
            updateLoadingStatus('chartjs', 'pending');
            updateLoadingStatus('leaflet', 'pending'); 
            updateLoadingStatus('jspdf', 'pending');
            
            loadChartJS();
            
            // Load Leaflet with fallback
            loadLibraryWithFallback([
                'https://cdn.jsdelivr.net/npm/leaflet@1.9.4/dist/leaflet.js',
                'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js'
            ], 'Leaflet', function() {
                // Create comprehensive Leaflet fallback that works with MapManager
                console.log('🗺️ Creating comprehensive Leaflet fallback...');
                
                window.L = {
                    // Map constructor
                    map: function(elementId, options) {
                        const element = document.getElementById(elementId);
                        if (element) {
                            element.innerHTML = `
                                <div style="width: 100%; height: 100%; background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); 
                                           display: flex; align-items: center; justify-content: center; color: white; font-size: 18px; 
                                           border-radius: 10px; position: relative; box-shadow: inset 0 0 50px rgba(0,0,0,0.3);">
                                    <div style="text-align: center; z-index: 10;">
                                        <div style="font-size: 48px; margin-bottom: 16px;">🗺️</div>
                                        <div style="font-weight: bold; margin-bottom: 8px;">Interactive Map</div>
                                        <div style="font-size: 14px; opacity: 0.8; margin-bottom: 16px;">
                                            Doha, Qatar • Real-time Tracking Available
                                        </div>
                                        <div style="font-size: 12px; opacity: 0.6; background: rgba(255,255,255,0.1); 
                                                  padding: 8px 12px; border-radius: 15px; display: inline-block;">
                                            📍 GPS: 25.2854°N, 51.5310°E
                                        </div>
                                    </div>
                                    <div id="mapDriverMarkers" style="position: absolute; bottom: 20px; right: 20px; 
                                                                   background: rgba(0,0,0,0.5); padding: 10px; border-radius: 8px; 
                                                                   font-size: 12px;">
                                        <div style="color: #4ade80;">🚛 Drivers: <span id="activeDriverCount">0</span></div>
                                        <div style="color: #60a5fa;">📍 Locations: Tracked</div>
                                    </div>
                                </div>
                            `;
                        }
                        
                        return {
                            setView: function(center, zoom) {
                                console.log(`🗺️ Map view set to: ${center} at zoom ${zoom}`);
                                return this;
                            },
                            addTo: function(container) { return this; },
                            on: function(event, handler) {
                                console.log(`🗺️ Map event listener added: ${event}`);
                                return this;
                            },
                            off: function(event, handler) { return this; },
                            invalidateSize: function() { 
                                console.log('🗺️ Map size invalidated');
                                return this; 
                            },
                            addLayer: function(layer) {
                                console.log('🗺️ Layer added to map');
                                return this;
                            },
                            removeLayer: function(layer) {
                                console.log('🗺️ Layer removed from map');
                                return this;
                            },
                            fitBounds: function(bounds, options) {
                                console.log('🗺️ Map bounds fitted');
                                return this;
                            },
                            getBounds: function() {
                                return {
                                    getSouthWest: () => ({ lat: 25.2, lng: 51.4 }),
                                    getNorthEast: () => ({ lat: 25.3, lng: 51.6 })
                                };
                            },
                            getCenter: function() {
                                return { lat: 25.2854, lng: 51.5310 };
                            },
                            getZoom: function() { return 13; },
                            panTo: function(latlng) {
                                console.log(`🗺️ Map panned to: ${latlng}`);
                                return this;
                            }
                        };
                    },
                    
                    // Tile layer
                    tileLayer: function(url, options) {
                        console.log('🗺️ Tile layer created:', url);
                        return {
                            addTo: function(map) {
                                console.log('🗺️ Tile layer added to map');
                                return this;
                            },
                            remove: function() { return this; }
                        };
                    },
                    
                    // Markers
                    marker: function(latlng, options) {
                        console.log('📍 Marker created at:', latlng);
                        // Update driver count display
                        const driverCount = document.getElementById('activeDriverCount');
                        if (driverCount) {
                            const current = parseInt(driverCount.textContent) || 0;
                            driverCount.textContent = current + 1;
                        }
                        
                        return {
                            addTo: function(map) {
                                console.log('📍 Marker added to map');
                                return this;
                            },
                            bindPopup: function(content) {
                                console.log('📍 Popup bound to marker:', content);
                                return this;
                            },
                            openPopup: function() {
                                console.log('📍 Marker popup opened');
                                return this;
                            },
                            closePopup: function() { return this; },
                            setLatLng: function(latlng) {
                                console.log('📍 Marker position updated:', latlng);
                                return this;
                            },
                            getLatLng: function() {
                                return latlng || { lat: 25.2854, lng: 51.5310 };
                            },
                            remove: function() {
                                console.log('📍 Marker removed');
                                return this;
                            },
                            setIcon: function(icon) {
                                console.log('📍 Marker icon set');
                                return this;
                            }
                        };
                    },
                    
                    // Layer groups
                    layerGroup: function(layers) {
                        return {
                            addTo: function(map) {
                                console.log('📁 Layer group added');
                                return this;
                            },
                            clearLayers: function() {
                                console.log('📁 Layer group cleared');
                                return this;
                            },
                            addLayer: function(layer) { return this; },
                            removeLayer: function(layer) { return this; }
                        };
                    },
                    
                    // Icons
                    divIcon: function(options) {
                        console.log('🎯 Div icon created');
                        return { options: options || {} };
                    },
                    
                    icon: function(options) {
                        console.log('🎯 Icon created');
                        return { options: options || {} };
                    },
                    
                    // Polylines for routes
                    polyline: function(latlngs, options) {
                        console.log('📍 Route polyline created');
                        return {
                            addTo: function(map) {
                                console.log('📍 Route added to map');
                                return this;
                            },
                            remove: function() {
                                console.log('📍 Route removed');
                                return this;
                            },
                            setLatLngs: function(latlngs) { return this; },
                            getLatLngs: function() { return []; }
                        };
                    },
                    
                    // Utility functions
                    latLng: function(lat, lng) {
                        return { lat: lat, lng: lng };
                    },
                    
                    latLngBounds: function(corner1, corner2) {
                        return {
                            extend: function(latlng) { return this; },
                            isValid: function() { return true; }
                        };
                    }
                };
                
                console.log('🗺️ Comprehensive Leaflet fallback created successfully');
            });
            
            // Load jsPDF with fallback
            loadLibraryWithFallback([
                'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js',
                'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js'
            ], 'jsPDF', function() {
                window.jsPDF = function() {
                    return {
                        text: function() { return this; },
                        save: function() { console.log('📄 PDF save requested (fallback)'); },
                        addPage: function() { return this; }
                    };
                };
            });
        });
    </script>
    
    <!-- Application Styles -->
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="map-fix.css">
</head>
<body>
    <!-- Library Loading Status -->
    <div id="library-status" style="position: fixed; top: 10px; right: 10px; background: rgba(255, 255, 255, 0.95); padding: 8px 12px; border-radius: 6px; box-shadow: 0 2px 12px rgba(0,0,0,0.15); font-size: 12px; z-index: 10000; display: block; backdrop-filter: blur(10px); border: 1px solid rgba(0,0,0,0.1);">
        <div id="status-text" style="color: #666; font-weight: 500;">
            🔄 Loading external libraries...
        </div>
    </div>
    
    <!-- Login Overlay -->
    <div class="login-overlay" id="loginOverlay">
        <div class="login-container">
            <div class="login-header">
                <div class="login-logo">
                    <i class="fas fa-cube"></i>
                </div>
                <h2 style="color: #e2e8f0; margin-bottom: 0.5rem;">Autonautics</h2>
                <p style="color: #94a3b8; font-size: 0.875rem;">Smart Waste Management System</p>
            </div>
            
            <div class="user-type-selector">
                <div class="user-type-btn active" data-user-type="manager">
                    <i class="fas fa-user-tie" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <div>Manager</div>
                </div>
                <div class="user-type-btn" data-user-type="driver">
                    <i class="fas fa-truck" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <div>Driver</div>
                </div>
                <div class="user-type-btn" data-user-type="admin">
                    <i class="fas fa-user-shield" style="font-size: 1.5rem; margin-bottom: 0.5rem;"></i>
                    <div>Admin</div>
                </div>
            </div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="username" placeholder="Enter your username" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-input" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i class="fas fa-sign-in-alt"></i>
                    Login
                </button>
            </form>
            
            <div style="margin-top: 1rem; text-align: center;">
                <a href="#" id="showRegistrationLink" style="color: var(--primary); text-decoration: none;">
                    New user? Register here
                </a>
            </div>
            
            <div style="margin-top: 1.5rem; text-align: center; color: #64748b; font-size: 0.875rem;">
                <p>Demo Credentials:</p>
                <p>Admin: admin / admin123</p>
                <p>Manager: manager1 / manager123</p>
                <p>Driver: driver1 / driver123</p>
                <div style="margin-top: 1rem;">
                    <button type="button" id="fixAccountsBtn" class="btn btn-secondary btn-sm" style="font-size: 0.75rem;">
                        <i class="fas fa-wrench"></i> Fix Demo Accounts
                    </button>
                </div>
            </div>
        </div>
    </div>



    <!-- Registration Modal -->
    <div id="registrationModal" class="modal" style="z-index: 10000;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>User Registration</h2>
                <span class="close" data-modal="registrationModal">&times;</span>
            </div>
            <div class="modal-body">
                <form id="registrationForm">
                    <div class="form-group">
                        <label class="form-label">User Type</label>
                        <select class="form-input" id="regUserType">
                            <option value="driver">Driver</option>
                            <option value="manager">Manager</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Full Name *</label>
                        <input type="text" class="form-input" id="regFullName" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username *</label>
                        <input type="text" class="form-input" id="regUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email *</label>
                        <input type="email" class="form-input" id="regEmail" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Phone Number *</label>
                        <input type="tel" class="form-input" id="regPhone" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Password *</label>
                        <input type="password" class="form-input" id="regPassword" required minlength="6">
                    </div>
                    <div class="form-group" id="vehicleIdGroup" style="display: block;">
                        <label class="form-label">Vehicle ID (Drivers Only)</label>
                        <input type="text" class="form-input" id="regVehicleId" placeholder="DA130-XX">
                    </div>
                    <div class="form-group" id="licenseGroup" style="display: block;">
                        <label class="form-label">License Number (Drivers Only)</label>
                        <input type="text" class="form-input" id="regLicense" placeholder="DL-XXXXX">
                    </div>
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid var(--warning); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <p style="margin: 0; color: var(--warning); font-size: 0.875rem;">
                            <i class="fas fa-info-circle"></i> Note: Registration requires admin approval. You will be notified once approved.
                        </p>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-plus"></i>
                        Submit Registration
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- User Info Badge -->
    <div class="user-info-badge" id="userInfoBadge" style="display: none;">
        <div class="user-avatar" id="userAvatar">AD</div>
        <div class="user-details">
            <div class="user-name" id="userName">Admin User</div>
            <div class="user-role" id="userRole">Manager</div>
        </div>
        <button class="logout-btn" id="logoutBtn">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>
    </div>

    <!-- Background Elements -->
    <div class="bg-container"></div>
    <div class="grid-background"></div>
    <div class="floating-orbs">
        <div class="orb orb1"></div>
        <div class="orb orb2"></div>
    </div>
    
    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>
    
    <!-- Navigation -->
    <nav class="nav" id="mainNav" style="display: none;">
        <div class="nav-content">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-cube"></i>
                </div>
                <span>Autonautics</span>
            </div>
            <ul class="nav-menu" id="navMenu">
                <!-- Navigation items will be populated dynamically based on user type -->
            </ul>
        </div>
    </nav>

    <!-- Driver Only View -->
    <div class="driver-only-view" id="driverOnlyView" style="display: none;">
        <div class="driver-mobile-container">
            <div class="driver-mobile-header">
                <div>
                    <div style="font-weight: bold; font-size: 1.25rem; color: white;">Driver Dashboard</div>
                    <div style="font-size: 0.875rem; color: #94a3b8;" id="driverNameMobile">John Smith</div>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 0.875rem; color: #94a3b8;">Status</div>
                    <div id="driverStatusIndicator" style="color: var(--success); font-weight: bold;">Online</div>
                </div>
            </div>

            <!-- GPS Status -->
            <div class="glass-card" style="margin-bottom: 1rem; background: rgba(0, 212, 255, 0.1); border: 1px solid rgba(0, 212, 255, 0.3);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-satellite-dish" style="font-size: 1.5rem; color: var(--primary);"></i>
                    <div style="flex: 1;">
                        <div style="font-weight: bold;">GPS Status</div>
                        <div id="gpsStatus" style="font-size: 0.875rem; color: #94a3b8;">Searching for signal...</div>
                    </div>
                    <button class="btn btn-primary btn-sm" id="refreshGPSBtn">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>

            <!-- Sync Status -->
            <div class="glass-card" style="margin-bottom: 1rem; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3);">
                <div style="display: flex; align-items: center; gap: 1rem;">
                    <i class="fas fa-cloud-upload-alt" id="syncIcon" style="font-size: 1.5rem; color: var(--success);"></i>
                    <div style="flex: 1;">
                        <div style="font-weight: bold;">Sync Status</div>
                        <div id="syncStatus" style="font-size: 0.875rem; color: #94a3b8;">Connecting to server...</div>
                    </div>
                    <div id="syncIndicator" style="
                        width: 12px; 
                        height: 12px; 
                        border-radius: 50%; 
                        background: #10b981;
                        animation: pulse 2s infinite;
                    "></div>
                </div>
            </div>

            <!-- Driver Stats -->
            <div class="driver-stats-grid">
                <div class="driver-stat-card">
                    <i class="fas fa-route" style="font-size: 1.5rem; color: var(--primary); margin-bottom: 0.5rem;"></i>
                    <div class="driver-stat-value" id="driverTodayCollections">0</div>
                    <div class="driver-stat-label">Today's Collections</div>
                </div>
                <div class="driver-stat-card">
                    <i class="fas fa-trash" style="font-size: 1.5rem; color: var(--success); margin-bottom: 0.5rem;"></i>
                    <div class="driver-stat-value" id="driverPendingBins">0</div>
                    <div class="driver-stat-label">Pending Bins</div>
                </div>
                <div class="driver-stat-card">
                    <i class="fas fa-gas-pump" style="font-size: 1.5rem; color: var(--warning); margin-bottom: 0.5rem;"></i>
                    <div class="driver-stat-value" id="driverFuelLevel">100%</div>
                    <div class="driver-stat-label">Fuel Level</div>
                </div>
                <div class="driver-stat-card">
                    <i class="fas fa-star" style="font-size: 1.5rem; color: #ffd700; margin-bottom: 0.5rem;"></i>
                    <div class="driver-stat-value" id="driverRating">5.0</div>
                    <div class="driver-stat-label">Rating</div>
                </div>
            </div>

            <!-- Enhanced Action Buttons -->
            <div class="driver-action-buttons-grid">
                <button class="driver-action-card" id="startRouteBtn" data-action="route">
                    <div class="action-icon-container">
                        <i class="fas fa-play-circle"></i>
                        <div class="action-status-dot" id="routeStatusDot"></div>
                    </div>
                    <div class="action-content">
                        <h4 class="action-title">Start Route</h4>
                        <p class="action-subtitle" id="routeStatusText">Ready to begin</p>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </button>

                <button class="driver-action-card pickup" id="registerPickupBtn" data-action="pickup">
                    <div class="action-icon-container">
                        <i class="fas fa-check-circle"></i>
                        <div class="action-badge" id="pickupBadge">0</div>
                    </div>
                    <div class="action-content">
                        <h4 class="action-title">Register Pickup</h4>
                        <p class="action-subtitle" id="pickupStatusText">Bins available</p>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </button>

                <button class="driver-action-card issue" id="reportIssueDriverBtn" data-action="issue">
                    <div class="action-icon-container">
                        <i class="fas fa-exclamation-triangle"></i>
                        <div class="action-pulse-ring"></div>
                    </div>
                    <div class="action-content">
                        <h4 class="action-title">Report Issue</h4>
                        <p class="action-subtitle">Emergency & problems</p>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </button>

                <button class="driver-action-card fuel" id="updateFuelBtn" data-action="fuel">
                    <div class="action-icon-container">
                        <i class="fas fa-gas-pump"></i>
                        <div class="fuel-level-indicator" id="fuelLevelIndicator">
                            <div class="fuel-bar" id="fuelBar"></div>
                        </div>
                    </div>
                    <div class="action-content">
                        <h4 class="action-title">Update Fuel</h4>
                        <p class="action-subtitle" id="fuelStatusText">75% remaining</p>
                    </div>
                    <div class="action-arrow">
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </button>
            </div>

            <!-- 🤖 ENHANCED AI RECOMMENDATION CARD - Connected to Main AI System -->
            <div class="enhanced-ai-suggestion-card" id="aiSuggestionCard" style="display: none;">
                <!-- AI Status Indicator -->
                <div class="ai-status-bar">
                    <div class="ai-status-indicator" id="aiStatusIndicator">
                        <div class="ai-pulse-dot"></div>
                        <span id="aiStatusText">AI Active</span>
                    </div>
                    <div class="ai-confidence-badge" id="aiConfidenceBadge">
                        <i class="fas fa-brain"></i>
                        <span id="aiConfidenceLevel">95%</span>
                    </div>
                </div>

                <!-- AI Header with Animation -->
                <div class="ai-header-section">
                    <div class="ai-title-area">
                        <div class="ai-brain-icon">
                            <i class="fas fa-robot"></i>
                            <div class="ai-thinking-animation"></div>
                        </div>
                        <div class="ai-title-text">
                            <h3>🎯 Smart Collection Assistant</h3>
                            <p>AI-powered route optimization</p>
                        </div>
                    </div>
                    <div class="ai-controls">
                        <button class="ai-refresh-btn" onclick="refreshDriverAISuggestion()" title="Refresh AI recommendations">
                            <i class="fas fa-sync-alt" id="aiRefreshIcon"></i>
                        </button>
                        <button class="ai-settings-btn" onclick="showAISettings()" title="AI settings">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>

                <!-- Primary Recommendation -->
                <div class="primary-recommendation" id="primaryRecommendation">
                    <div class="recommendation-header">
                        <div class="priority-badge" id="recommendationPriority">
                            <i class="fas fa-star"></i>
                            <span>HIGH PRIORITY</span>
                        </div>
                        <div class="ai-reasoning-indicator" onclick="showAIReasoning()">
                            <i class="fas fa-question-circle"></i>
                        </div>
                    </div>

                    <div class="bin-recommendation-card">
                        <div class="bin-visual">
                            <div class="bin-icon-container">
                                <i class="fas fa-trash-alt" id="recommendedBinIcon"></i>
                                <div class="fill-level-ring" id="fillLevelRing">
                                    <div class="fill-percentage" id="fillPercentage">0%</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bin-info-section">
                            <div class="bin-primary-info">
                                <h4 class="bin-id" id="recommendedBinId">Analyzing...</h4>
                                <p class="bin-location" id="recommendedBinLocation">Calculating optimal route...</p>
                            </div>
                            
                            <div class="bin-status-chips">
                                <div class="status-chip urgent" id="urgencyChip">
                                    <i class="fas fa-exclamation"></i>
                                    <span id="urgencyLevel">Urgent</span>
                                </div>
                                <div class="status-chip efficiency" id="efficiencyChip">
                                    <i class="fas fa-route"></i>
                                    <span id="efficiencyLevel">Optimal</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Smart Metrics Grid -->
                    <div class="smart-metrics-grid">
                        <div class="metric-card distance">
                            <div class="metric-icon">
                                <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartDistance">Calculating...</span>
                                <span class="metric-label">Distance</span>
                            </div>
                            <div class="metric-trend" id="distanceTrend">
                                <i class="fas fa-arrow-down text-success"></i>
                            </div>
                        </div>

                        <div class="metric-card time">
                            <div class="metric-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartTime">Estimating...</span>
                                <span class="metric-label">Est. Time</span>
                            </div>
                            <div class="metric-trend" id="timeTrend">
                                <i class="fas fa-arrow-right text-warning"></i>
                            </div>
                        </div>

                        <div class="metric-card savings">
                            <div class="metric-icon">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartSavings">Computing...</span>
                                <span class="metric-label">CO₂ Saved</span>
                            </div>
                            <div class="metric-trend" id="savingsTrend">
                                <i class="fas fa-arrow-up text-success"></i>
                            </div>
                        </div>

                        <div class="metric-card score">
                            <div class="metric-icon">
                                <i class="fas fa-trophy"></i>
                            </div>
                            <div class="metric-data">
                                <span class="metric-value" id="smartScore">Loading...</span>
                                <span class="metric-label">AI Score</span>
                            </div>
                            <div class="metric-trend" id="scoreTrend">
                                <i class="fas fa-arrow-up text-success"></i>
                            </div>
                        </div>
                    </div>

                    <!-- AI Reasoning Panel -->
                    <div class="ai-reasoning-panel" id="aiReasoningPanel">
                        <div class="reasoning-header">
                            <i class="fas fa-lightbulb"></i>
                            <span>AI Reasoning</span>
                        </div>
                        <div class="reasoning-content" id="aiReasoningContent">
                            Analyzing optimal collection route based on proximity, urgency, and efficiency factors...
                        </div>
                        <div class="reasoning-factors" id="reasoningFactors">
                            <!-- Dynamic reasoning factors will be inserted here -->
                        </div>
                    </div>

                    <!-- Smart Action Buttons -->
                    <div class="smart-action-buttons">
                        <button class="primary-action-btn" onclick="acceptSmartRecommendation()" id="acceptBtn">
                            <div class="btn-icon">
                                <i class="fas fa-route"></i>
                            </div>
                            <div class="btn-content">
                                <span class="btn-title">Start Collection</span>
                                <span class="btn-subtitle">Accept AI route</span>
                            </div>
                        </button>

                        <div class="secondary-actions">
                            <button class="secondary-action-btn" onclick="viewRecommendationDetails()" title="View full details">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="secondary-action-btn" onclick="showAlternativeRoutes()" title="Alternative routes">
                                <i class="fas fa-random"></i>
                            </button>
                            <button class="secondary-action-btn" onclick="dismissSmartRecommendation()" title="Dismiss recommendation">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Loading State -->
                <div class="ai-loading-state" id="aiLoadingState">
                    <div class="loading-animation">
                        <div class="ai-brain-loader">
                            <i class="fas fa-brain"></i>
                            <div class="pulse-rings">
                                <div class="pulse-ring"></div>
                                <div class="pulse-ring"></div>
                                <div class="pulse-ring"></div>
                            </div>
                        </div>
                        <h4>AI Computing Optimal Route...</h4>
                        <p>Analyzing traffic, bin priorities, and efficiency factors</p>
                    </div>
                </div>

                <!-- No Recommendations State -->
                <div class="no-recommendations-state" id="noRecommendationsState" style="display: none;">
                    <div class="empty-state-content">
                        <i class="fas fa-check-circle"></i>
                        <h4>All Set!</h4>
                        <p>No urgent collections needed at the moment</p>
                        <button class="btn-secondary" onclick="refreshDriverAISuggestion()">
                            <i class="fas fa-sync-alt"></i> Check Again
                        </button>
                    </div>
                </div>
            </div>

            <!-- 💬 DRIVER MESSAGING SYSTEM - Real-time Chat with Management -->
            <div class="enhanced-messaging-system" id="driverMessagingSystem">
                <div class="messaging-header">
                    <div class="messaging-title">
                        <i class="fas fa-comments"></i>
                        <h3>Messages</h3>
                        <span class="message-count" id="unreadMessageCount" style="display: none;">0</span>
                    </div>
                    <div class="messaging-actions">
                        <button class="messaging-action-btn" onclick="toggleMessagingSystem()" id="toggleMessagingBtn">
                            <i class="fas fa-chevron-down"></i>
                        </button>
                    </div>
                </div>
                
                <div class="messaging-content" id="messagingContent">
                    <!-- Online Status -->
                    <div class="messaging-status">
                        <div class="status-indicator online"></div>
                        <span>Management Team</span>
                        <div class="typing-indicator" id="typingIndicator" style="display: none;">
                            <span>Typing...</span>
                            <div class="typing-dots">
                                <span></span><span></span><span></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Messages Container -->
                    <div class="messages-container" id="messagesContainer">
                        <div class="welcome-message">
                            <i class="fas fa-info-circle"></i>
                            <p>Welcome! You can receive messages from the management team here.</p>
                            <p>All messages are delivered in real-time.</p>
                        </div>
                    </div>
                    
                    <!-- Message Input -->
                    <div class="message-input-container">
                        <div class="message-input-wrapper">
                            <input type="text" 
                                   id="driverMessageInput" 
                                   placeholder="Type your message..." 
                                   maxlength="500"
                                   autocomplete="off">
                            <div class="message-input-actions">
                                <button class="emoji-btn" onclick="showEmojiPicker()" title="Add Emoji">
                                    😊
                                </button>
                                <button class="send-btn" onclick="sendDriverMessage()" id="sendMessageBtn" disabled>
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        </div>
                        <div class="message-tools">
                            <button class="tool-btn" onclick="attachImage()" title="Attach Image">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="tool-btn" onclick="shareLocation()" title="Share Location">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button class="tool-btn emergency" onclick="sendEmergencyMessage()" title="Emergency Alert">
                                <i class="fas fa-exclamation-triangle"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Quick Replies -->
                    <div class="quick-replies" id="quickReplies">
                        <button class="quick-reply-btn" onclick="sendQuickReply('✅ Acknowledged')">
                            ✅ Acknowledged
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('🚛 On my way')">
                            🚛 On my way
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('⏰ Need more time')">
                            ⏰ Need more time
                        </button>
                        <button class="quick-reply-btn" onclick="sendQuickReply('❓ Need clarification')">
                            ❓ Need clarification
                        </button>
                    </div>
                </div>
            </div>

            <!-- Route List -->
            <h3 style="margin-bottom: 1rem; color: #e2e8f0;">Assigned Routes</h3>
            <div class="driver-route-list" id="driverRouteList">
                <!-- Routes will be populated here -->
            </div>

            <!-- Driver History Button -->
            <button class="btn btn-info" style="width: 100%; margin-top: 1.5rem;" onclick="showDriverHistoryModal()">
                <i class="fas fa-history"></i>
                My Collection History
            </button>
            
            <!-- Sample Data Generation Button (for testing) -->
            <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem; font-size: 0.85rem;" onclick="generateComprehensiveSampleData()">
                <i class="fas fa-flask"></i>
                Generate Sample Data
            </button>

            <!-- Navigation Map Button -->
            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" id="openDriverMapBtn">
                <i class="fas fa-map-marked-alt"></i>
                Open Navigation Map
            </button>
        </div>

        <!-- Driver Quick Actions -->
        <div class="driver-quick-actions">
            <button class="quick-action-btn" id="scanBinQRBtn" title="Scan QR Code">
                <i class="fas fa-qrcode"></i>
            </button>
            <button class="quick-action-btn" id="callDispatchBtn" title="Call Dispatch">
                <i class="fas fa-phone"></i>
            </button>
            <button class="quick-action-btn" id="takeBreakBtn" title="Take Break">
                <i class="fas fa-coffee"></i>
            </button>
            <button class="quick-action-btn" id="endShiftBtn" title="End Shift">
                <i class="fas fa-power-off"></i>
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container" id="mainContainer" style="display: none;">
        <!-- City Dashboard Section -->
        <div id="dashboard" class="content-section active">
            <h1 style="font-size: 2.5rem; margin-bottom: 2rem; background: linear-gradient(135deg, #fff 0%, #94a3b8 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                Smart City Command Center
            </h1>
            
            <!-- Key Metrics -->
            <div class="stats-grid">
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--primary);">
                            <i class="fas fa-city"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="cleanlinessIndex">0%</div>
                    <div class="stat-label">City Cleanliness Index</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cleanlinessProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="todayCollections">0</div>
                    <div class="stat-label">Collections Today</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="collectionsProgress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeComplaintsCount">0</div>
                    <div class="stat-label">Active Complaints</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="complaintsProgress" style="width: 0%; background: var(--warning);"></div>
                    </div>
                </div>

                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--secondary);">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="costReduction">0%</div>
                    <div class="stat-label">Cost Reduction</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="costProgress" style="width: 0%; background: var(--secondary);"></div>
                    </div>
                </div>
            </div>

            <!-- City Overview -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h2 style="margin-bottom: 1.5rem;">City-Wide Impact</h2>
                <div class="stats-grid">
                    <div class="city-metric">
                        <i class="fas fa-smile metric-icon-large"></i>
                        <div class="stat-value" id="citizenSatisfaction">0%</div>
                        <div class="stat-label">Citizen Satisfaction</div>
                    </div>
                    <div class="city-metric">
                        <i class="fas fa-leaf metric-icon-large"></i>
                        <div class="stat-value" id="carbonReduction">0%</div>
                        <div class="stat-label">Carbon Emissions</div>
                    </div>
                    <div class="city-metric">
                        <i class="fas fa-clock metric-icon-large"></i>
                        <div class="stat-value" id="avgResponseTime">0min</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1rem;">Quick Actions</h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="emergencyResponseBtn">
                        <i class="fas fa-exclamation-triangle"></i>
                        Emergency Response
                    </button>
                    <button class="btn btn-secondary" id="optimizeRoutesBtn">
                        <i class="fas fa-magic"></i>
                        Optimize All Routes
                    </button>
                    <button class="btn btn-secondary" id="generateReportBtn">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF Report
                    </button>
                </div>
            </div>
        </div>

        <!-- Live Monitoring Section -->
        <div id="monitoring" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">Live Monitoring System</h1>
            
            <!-- Map Container -->
            <div class="map-container">
                <div id="map" style="height: 600px; width: 100%; border-radius: 20px;"></div>
                <div id="mapLoading" class="map-loading" style="display: none;">
                    <div class="spinner"></div>
                    <div>Loading Map...</div>
                </div>
                
                <!-- Tracking Panel -->
                <div class="tracking-panel">
                    <!-- Live Status -->
                    <div class="glass-card">
                        <div class="tracking-header">
                            <h3>System Status</h3>
                            <div class="live-indicator">
                                <div class="live-dot"></div>
                                <span>LIVE</span>
                            </div>
                        </div>
                        
                        <div class="stats-grid" style="margin-top: 1rem;">
                            <div style="text-align: center;">
                                <div class="stat-value" id="activeSensorsCount">0</div>
                                <div class="stat-label">Active Sensors</div>
                            </div>
                            <div style="text-align: center;">
                                <div class="stat-value" id="onlineVehiclesCount">0</div>
                                <div class="stat-label">Online Vehicles</div>
                            </div>
                            <div style="text-align: center;">
                                <div class="stat-value" id="activeDriversStatus">0</div>
                                <div class="stat-label">Active Drivers</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Critical Bins -->
                    <div class="glass-card" style="margin-top: 1rem;">
                        <h4 style="margin-bottom: 1rem;">Critical Bins</h4>
                        <div class="bin-list" id="criticalBinsList">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                    
                    <!-- Active Alerts -->
                    <div class="glass-card" style="margin-top: 1rem;">
                        <h4 style="margin-bottom: 1rem;">Active Alerts</h4>
                        <div id="activeAlertsList">
                            <!-- Will be populated dynamically -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Fleet Management Section -->
        <div id="fleet" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">Fleet Management</h1>
            
            <!-- Fleet Overview -->
            <div class="stats-grid">
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--primary);">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeVehiclesCount">0</div>
                    <div class="stat-label">Active Vehicles</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-user-check"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="availableDriversCount">0</div>
                    <div class="stat-label">Available Drivers</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-route"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeRoutesCount">0</div>
                    <div class="stat-label">Active Routes</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--danger);">
                            <i class="fas fa-tools"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="maintenanceVehiclesCount">0</div>
                    <div class="stat-label">In Maintenance</div>
                </div>
            </div>
            
            <!-- Driver List -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Driver Management</h3>
                <div class="driver-list" id="fleetDriversList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- Vehicle List -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Vehicle Status</h3>
                <div id="vehicleStatusList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- ML Routes Section -->
        <div id="routes" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">ML Route Optimization</h1>
            
            <!-- ML Optimization Panel -->
            <div class="ml-panel">
                <div class="ml-header">
                    <div class="ml-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0;">AI-Powered Route Optimization</h3>
                        <p style="margin: 0.5rem 0 0 0; color: #94a3b8;">Using machine learning to optimize collection routes</p>
                    </div>
                </div>
                
                <div class="optimization-metrics">
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--primary); margin-bottom: 0.5rem;">
                            <i class="fas fa-route"></i>
                        </div>
                        <div class="stat-value" id="distanceReduction">-0%</div>
                        <div class="stat-label">Distance Reduced</div>
                    </div>
                    
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--success); margin-bottom: 0.5rem;">
                            <i class="fas fa-gas-pump"></i>
                        </div>
                        <div class="stat-value" id="fuelSaved">-0%</div>
                        <div class="stat-label">Fuel Saved</div>
                    </div>
                    
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--warning); margin-bottom: 0.5rem;">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="timePerRoute">0min</div>
                        <div class="stat-label">Time Per Route</div>
                    </div>
                    
                    <div class="optimization-card">
                        <div class="stat-icon" style="color: var(--secondary); margin-bottom: 0.5rem;">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-value" id="efficiencyScore">0%</div>
                        <div class="stat-label">Efficiency Score</div>
                    </div>
                </div>
            </div>
            
            <!-- Route Efficiency Chart -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Route Efficiency Trends</h3>
                <div class="chart-container">
                    <canvas id="routeChart"></canvas>
                </div>
            </div>
            
            <!-- Predictive Fill Chart -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Predictive Fill Levels</h3>
                <div class="chart-container">
                    <canvas id="predictiveChart"></canvas>
                </div>
            </div>
            
            <!-- Optimized Routes List -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">Today's Optimized Routes</h3>
                <div id="optimizedRoutesList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- Complaints Section -->
        <div id="complaints" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">Complaint Management</h1>
            
            <!-- Complaint Stats -->
            <div class="stats-grid">
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--danger);">
                            <i class="fas fa-exclamation-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="openComplaintsCount">0</div>
                    <div class="stat-label">Open Complaints</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-clock"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="pendingComplaintsCount">0</div>
                    <div class="stat-label">In Progress</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-check-circle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="resolvedComplaintsCount">0</div>
                    <div class="stat-label">Resolved Today</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--primary);">
                            <i class="fas fa-chart-line"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="avgResolutionTime">0h</div>
                    <div class="stat-label">Avg Resolution Time</div>
                </div>
            </div>
            
            <!-- New Complaint Button -->
            <div style="margin: 2rem 0;">
                <button class="btn btn-primary" onclick="showNewComplaintForm()">
                    <i class="fas fa-plus"></i> Register New Complaint
                </button>
            </div>
            
            <!-- Complaints List -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1.5rem;">Active Complaints</h3>
                <div id="complaintsList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
        </div>

        <!-- AI/ML Dashboard Section -->
        <div id="ai-dashboard" class="content-section" style="display: none;">
            <div class="ai-dashboard-header">
                <div class="ai-header-content">
                    <div class="ai-title-section">
                        <div class="ai-icon-large">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <h1 style="font-size: 2.5rem; margin: 0; color: var(--primary);">AI/ML Control Center</h1>
                            <p style="margin: 0.5rem 0 0 0; font-size: 1.2rem; color: #94a3b8;">World-Class Artificial Intelligence & Machine Learning Platform</p>
                        </div>
                    </div>
                    
                    <div class="ai-status-indicator">
                        <div class="ai-status-light" id="aiStatusLight"></div>
                        <div class="ai-status-text">
                            <div class="ai-status-label">AI System Status</div>
                            <div class="ai-status-value" id="aiStatusValue">Initializing...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI System Overview -->
            <div class="ai-overview-grid">
                <div class="glass-card ai-module-card">
                    <div class="ai-module-header">
                        <div class="ai-module-icon" style="color: #00d4ff;">
                            <i class="fas fa-route"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0;">Route Optimizer</h3>
                            <p style="margin: 0.25rem 0 0 0; color: #94a3b8;">ML-Powered Routing</p>
                        </div>
                        <div class="ai-module-status" id="routeOptimizerStatus">
                            <div class="status-indicator active"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics">
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="routeEfficiencyImprovement">+18.5%</div>
                            <div class="ai-metric-label">Efficiency Gain</div>
                        </div>
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="distanceOptimization">-12.3%</div>
                            <div class="ai-metric-label">Distance Reduced</div>
                        </div>
                    </div>
                </div>

                <div class="glass-card ai-module-card">
                    <div class="ai-module-header">
                        <div class="ai-module-icon" style="color: #7c3aed;">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0;">Predictive Analytics</h3>
                            <p style="margin: 0.25rem 0 0 0; color: #94a3b8;">Future Forecasting</p>
                        </div>
                        <div class="ai-module-status" id="predictiveStatus">
                            <div class="status-indicator active"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics">
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="predictionAccuracy">94.7%</div>
                            <div class="ai-metric-label">Accuracy</div>
                        </div>
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="anomaliesDetected">12</div>
                            <div class="ai-metric-label">Anomalies Found</div>
                        </div>
                    </div>
                </div>

                <div class="glass-card ai-module-card">
                    <div class="ai-module-header">
                        <div class="ai-module-icon" style="color: #10b981;">
                            <i class="fas fa-user-cog"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0;">Driver Assistant</h3>
                            <p style="margin: 0.25rem 0 0 0; color: #94a3b8;">Intelligent Guidance</p>
                        </div>
                        <div class="ai-module-status" id="driverAssistantStatus">
                            <div class="status-indicator active"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics">
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="driverPerformanceBoost">+22.1%</div>
                            <div class="ai-metric-label">Performance</div>
                        </div>
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="aiRecommendations">156</div>
                            <div class="ai-metric-label">Recommendations</div>
                        </div>
                    </div>
                </div>

                <div class="glass-card ai-module-card">
                    <div class="ai-module-header">
                        <div class="ai-module-icon" style="color: #f59e0b;">
                            <i class="fas fa-brain"></i>
                        </div>
                        <div>
                            <h3 style="margin: 0;">Deep Learning</h3>
                            <p style="margin: 0.25rem 0 0 0; color: #94a3b8;">Neural Networks</p>
                        </div>
                        <div class="ai-module-status" id="deepLearningStatus">
                            <div class="status-indicator active"></div>
                        </div>
                    </div>
                    <div class="ai-module-metrics">
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="modelAccuracy">97.2%</div>
                            <div class="ai-metric-label">Model Accuracy</div>
                        </div>
                        <div class="ai-metric">
                            <div class="ai-metric-value" id="learningProgress">89.5%</div>
                            <div class="ai-metric-label">Learning</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Performance Charts -->
            <div class="ai-charts-section">
                <div class="charts-grid">
            <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">AI Performance Metrics</h4>
                        <div class="chart-container">
                            <canvas id="ai-performance-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Machine Learning Accuracy</h4>
                        <div class="chart-container">
                            <canvas id="ml-accuracy-chart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">Real-time AI Monitoring</h4>
                    <div class="ai-monitoring-dashboard">
                        <div class="monitoring-grid">
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-tachometer-alt"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiProcessingSpeed">2.3ms</div>
                                    <div class="monitoring-label">Processing Speed</div>
                                </div>
                            </div>
                            
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-memory"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiMemoryUsage">73.2%</div>
                                    <div class="monitoring-label">Memory Usage</div>
                                </div>
                            </div>
                            
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-microchip"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiCpuUsage">45.8%</div>
                                    <div class="monitoring-label">CPU Usage</div>
                                </div>
                            </div>
                            
                            <div class="monitoring-card">
                                <div class="monitoring-icon">
                                    <i class="fas fa-network-wired"></i>
                                </div>
                                <div class="monitoring-data">
                                    <div class="monitoring-value" id="aiThroughput">1.2K/s</div>
                                    <div class="monitoring-label">Throughput</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Analytics Section -->
        <div id="analytics" class="content-section" style="display: none;">
            <div class="analytics-header">
                <div class="analytics-header-content">
                    <div class="analytics-title-section">
                        <div class="analytics-icon-large">
                            <i class="fas fa-chart-bar"></i>
                        </div>
                        <div>
                            <h1 style="font-size: 2.5rem; margin: 0;">Advanced Analytics Dashboard</h1>
                            <p style="margin: 0.5rem 0 0 0; font-size: 1.2rem; color: #94a3b8;">AI-Powered Business Intelligence & Data Analytics</p>
                        </div>
                    </div>
                    
                    <div class="analytics-actions">
                        <button class="btn btn-primary" onclick="refreshAnalytics()">
                            <i class="fas fa-sync"></i> Refresh Data
                        </button>
                        <button class="btn btn-success" onclick="exportAnalytics()">
                            <i class="fas fa-download"></i> Export Report
                        </button>
                        <button class="btn btn-info" onclick="toggleRealTimeAnalytics()">
                            <i class="fas fa-play"></i> Real-Time Mode
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Real-Time System Overview -->
            <div class="analytics-overview">
                <div class="glass-card system-health-card">
                    <h3 style="margin-bottom: 1.5rem;">System Health & Performance</h3>
                    <div class="system-metrics-grid">
                        <div class="system-metric">
                            <div class="metric-icon" style="color: var(--primary);">
                                <i class="fas fa-tachometer-alt"></i>
                            </div>
                            <div class="metric-data">
                                <div class="stat-value" id="systemEfficiency">92.5%</div>
                        <div class="stat-label">System Efficiency</div>
                        <div class="progress-bar" style="margin-top: 0.5rem;">
                                    <div class="progress-fill" id="efficiencyProgressBar" style="width: 92.5%;"></div>
                                </div>
                        </div>
                    </div>
                    
                        <div class="system-metric">
                            <div class="metric-icon" style="color: var(--success);">
                                <i class="fas fa-recycle"></i>
                            </div>
                            <div class="metric-data">
                                <div class="stat-value" id="monthlyCollected">2,847kg</div>
                                <div class="stat-label">Monthly Collections</div>
                                <div class="metric-trend positive">
                                    <i class="fas fa-arrow-up"></i> +12.3%
                                </div>
                            </div>
                    </div>
                    
                        <div class="system-metric">
                            <div class="metric-icon" style="color: var(--warning);">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="metric-data">
                                <div class="stat-value" id="avgResponseTime">14.2min</div>
                        <div class="stat-label">Avg Response Time</div>
                                <div class="metric-trend negative">
                                    <i class="fas fa-arrow-down"></i> -5.8%
                                </div>
                            </div>
                    </div>
                    
                        <div class="system-metric">
                            <div class="metric-icon" style="color: var(--info);">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="metric-data">
                                <div class="stat-value" id="avgDriverRating">4.7/5</div>
                                <div class="stat-label">Driver Rating</div>
                                <div class="metric-trend positive">
                                    <i class="fas fa-arrow-up"></i> +0.3
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Advanced Analytics Navigation -->
            <div class="analytics-navigation">
                <div class="analytics-tabs">
                    <button class="analytics-tab active" data-tab="overview">
                        <i class="fas fa-chart-line"></i> Overview
                </button>
                    <button class="analytics-tab" data-tab="performance">
                        <i class="fas fa-tachometer-alt"></i> Performance
                </button>
                    <button class="analytics-tab" data-tab="predictive">
                        <i class="fas fa-crystal-ball"></i> Predictive
                    </button>
                    <button class="analytics-tab" data-tab="operational">
                        <i class="fas fa-cogs"></i> Operational
                </button>
                <button class="analytics-tab" data-tab="environmental">
                    <i class="fas fa-leaf"></i> Environmental
                </button>
                    <button class="analytics-tab" data-tab="financial">
                        <i class="fas fa-dollar-sign"></i> Financial
                </button>
                </div>
            </div>
            
            <!-- Tab Contents -->
            <div class="analytics-content active" id="overview-content">
                <div class="charts-grid">
                <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Collection Trends (Last 30 Days)</h4>
                    <div class="chart-container">
                            <canvas id="collections-trend-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Bin Fill Distribution</h4>
                        <div class="chart-container">
                            <canvas id="fill-distribution-chart"></canvas>
                    </div>
                </div>
            </div>
            
                <div class="glass-card" style="margin-top: 1.5rem;">
                    <h4 style="margin-bottom: 1rem;">Real-Time Activity Feed</h4>
                    <div class="activity-feed" id="analyticsActivityFeed">
                        <!-- Real-time activities will be populated here -->
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="performance-content" style="display: none;">
                <div class="charts-grid">
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Driver Performance Analysis</h4>
                        <div class="chart-container">
                            <canvas id="driver-performance-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Route Efficiency Metrics</h4>
                        <div class="chart-container">
                            <canvas id="route-efficiency-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="predictive-content" style="display: none;">
                <div class="glass-card">
                    <h4 style="margin-bottom: 1rem;">Predictive Analytics Dashboard</h4>
                    <div class="predictive-analytics-grid">
                        <div class="prediction-card">
                            <div class="prediction-header">
                                <h5>Demand Forecasting</h5>
                                <div class="prediction-accuracy">94.7% Accurate</div>
                            </div>
                    <div class="chart-container">
                                <canvas id="demand-forecast-chart"></canvas>
                            </div>
                        </div>
                        
                        <div class="prediction-card">
                            <div class="prediction-header">
                                <h5>Bin Overflow Prediction</h5>
                                <div class="prediction-accuracy">96.2% Accurate</div>
                            </div>
                            <div class="chart-container">
                                <canvas id="overflow-prediction-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="operational-content" style="display: none;">
                <div class="charts-grid">
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Operational Efficiency</h4>
                        <div class="chart-container">
                            <canvas id="operational-efficiency-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Resource Utilization</h4>
                        <div class="chart-container">
                            <canvas id="resource-utilization-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="environmental-content" style="display: none;">
                <div class="environmental-impact-dashboard">
                <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Environmental Impact Metrics</h4>
                        <div class="environmental-metrics-grid">
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #10b981;">
                                    <i class="fas fa-tree"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="treesSaved">234</div>
                            <div class="stat-label">Trees Saved</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-up"></i> +18 this month
                                    </div>
                                </div>
                        </div>
                        
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #3b82f6;">
                                    <i class="fas fa-cloud"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="co2Reduction">-15.7%</div>
                            <div class="stat-label">CO2 Reduction</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-down"></i> 2.4 tons saved
                                    </div>
                                </div>
                        </div>
                        
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #06b6d4;">
                                    <i class="fas fa-tint"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="waterSaved">12,450L</div>
                            <div class="stat-label">Water Saved</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-up"></i> +1,200L
                                    </div>
                                </div>
                        </div>
                        
                            <div class="environmental-metric">
                                <div class="env-metric-icon" style="color: #f59e0b;">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div class="env-metric-data">
                                    <div class="stat-value" id="energySaved">8,932 kWh</div>
                            <div class="stat-label">Energy Saved</div>
                                    <div class="metric-trend positive">
                                        <i class="fas fa-arrow-up"></i> +890 kWh
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card" style="margin-top: 1.5rem;">
                        <h4 style="margin-bottom: 1rem;">Sustainability Progress</h4>
                        <div class="chart-container">
                            <canvas id="sustainability-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="analytics-content" id="financial-content" style="display: none;">
                <div class="charts-grid">
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">Cost Analysis</h4>
                        <div class="chart-container">
                            <canvas id="cost-analysis-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="glass-card">
                        <h4 style="margin-bottom: 1rem;">ROI & Savings</h4>
                        <div class="chart-container">
                            <canvas id="roi-savings-chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Export Options -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h4 style="margin-bottom: 1rem;">Export Reports</h4>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="analyticsManager.generatePDFReport()">
                        <i class="fas fa-file-pdf"></i> Generate PDF Report
                    </button>
                    <button class="btn btn-secondary" onclick="analyticsManager.exportToCSV()">
                        <i class="fas fa-file-csv"></i> Export to CSV
                    </button>
                    <button class="btn btn-secondary" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Dashboard
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Panel Section -->
        <div id="admin" class="content-section" style="display: none;">
            <h1 style="font-size: 2rem; margin-bottom: 2rem;">Admin Control Panel</h1>
            
            <!-- Admin Action Buttons -->
            <div class="glass-card" style="margin-bottom: 2rem;">
                <h3 style="margin-bottom: 1rem;">
                    <i class="fas fa-cogs"></i> Admin Actions
                </h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-danger" onclick="showErrorLogsModal()">
                        <i class="fas fa-exclamation-triangle"></i>
                        View Error Logs
                    </button>
                    <button class="btn btn-warning" onclick="clearErrorLogs()">
                        <i class="fas fa-trash"></i>
                        Clear Error Logs
                    </button>
                    <button class="btn btn-secondary" onclick="exportSystemData()">
                        <i class="fas fa-download"></i>
                        Export System Data
                    </button>
                    <button class="btn btn-primary" onclick="generateComprehensiveSampleData()">
                        <i class="fas fa-database"></i>
                        Generate Sample Data
                    </button>
                    <button class="btn btn-success" onclick="generateComprehensiveReport()">
                        <i class="fas fa-file-pdf"></i>
                        Generate PDF Report
                    </button>
                </div>
            </div>
            
            <!-- Pending Registrations -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-user-plus"></i> Pending User Registrations
                </h3>
                <div id="pendingRegistrationsList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- User Management -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-users"></i> User Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on users to remove them</span>
                </h3>
                <div id="userManagementList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

             <!-- Vehicle Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-truck"></i> Vehicle Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on vehicles to remove them</span>
                 </h3>
                 <div id="vehicleManagementList">
                     <!-- Will be populated dynamically -->
                 </div>
             </div>

             <!-- Bin Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-trash"></i> Bin Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on bins to remove them</span>
                 </h3>
                 <div id="binManagementList">
                     <!-- Will be populated dynamically -->
                 </div>
             </div>

             <!-- Issue Management -->
             <div class="glass-card" style="margin-top: 2rem;">
                 <h3 style="margin-bottom: 1.5rem;">
                     <i class="fas fa-exclamation-circle"></i> Issue Management
                     <span style="font-size: 0.8rem; color: #94a3b8; margin-left: 1rem;">Click on issues to manage them</span>
                 </h3>
                 <div id="issueManagementList">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- System Statistics -->
            <div class="stats-grid" style="margin-top: 2rem;">
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--primary);">
                            <i class="fas fa-users"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalUsersCount">0</div>
                    <div class="stat-label">Total Users</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--success);">
                            <i class="fas fa-trash"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="totalBinsCount">0</div>
                    <div class="stat-label">Total Bins</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--warning);">
                            <i class="fas fa-truck"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeDriversCount">0</div>
                    <div class="stat-label">Active Drivers</div>
                </div>
                
                <div class="glass-card stat-card">
                    <div class="stat-header">
                        <div class="stat-icon" style="color: var(--danger);">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                    </div>
                    <div class="stat-value" id="activeAlertsCount">0</div>
                    <div class="stat-label">Active Alerts</div>
                </div>
            </div>
            
            <!-- System Logs -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-file-alt"></i> Recent System Logs
                </h3>
                <div id="systemLogsList" style="max-height: 300px; overflow-y: auto;">
                    <!-- Will be populated dynamically -->
                </div>
            </div>
            
            <!-- System Controls -->
            <div class="glass-card" style="margin-top: 2rem;">
                <h3 style="margin-bottom: 1.5rem;">
                    <i class="fas fa-cogs"></i> System Controls
                </h3>
                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" id="resetSystemBtn">
                        <i class="fas fa-sync"></i> Reset System Data
                    </button>
                    <button class="btn btn-secondary" id="exportDataBtn">
                        <i class="fas fa-download"></i> Export System Data
                    </button>
                    <button class="btn btn-secondary" id="viewLogsBtn">
                        <i class="fas fa-file-alt"></i> Download Full Logs
                    </button>
                    <button class="btn btn-warning" onclick="dataManager.fixCorruptedAccounts()">
                        <i class="fas fa-wrench"></i> Fix Corrupted Accounts
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Buttons -->
    <div class="fab-container" id="fabContainer" style="display: none;">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-option" id="reportIssueFab">
                <div class="fab-option-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <span class="fab-option-label">Report Issue</span>
            </div>
            <div class="fab-option" id="addBinFab">
                <div class="fab-option-icon">
                    <i class="fas fa-trash"></i>
                </div>
                <span class="fab-option-label">Add New Bin</span>
            </div>
            <div class="fab-option" id="addVehicleFab">
                <div class="fab-option-icon">
                    <i class="fas fa-truck"></i>
                </div>
                <span class="fab-option-label">Add Vehicle</span>
            </div>
        </div>
        <div class="fab" id="mainFab">
            <i class="fas fa-plus"></i>
        </div>
    </div>

<!-- Vehicle Registration Modal -->
<div id="vehicleRegistrationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-truck"></i> Register New Vehicle</h2>
            <span class="close" onclick="closeVehicleRegistrationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="vehicleRegistrationForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="vehicleId"><i class="fas fa-id-card"></i> Vehicle ID</label>
                        <input type="text" id="vehicleId" name="vehicleId" required placeholder="e.g., TRUCK-001">
                    </div>
                    <div class="form-group">
                        <label for="vehicleType"><i class="fas fa-truck"></i> Vehicle Type</label>
                        <select id="vehicleType" name="vehicleType" required>
                            <option value="">Select Type</option>
                            <option value="garbage_truck">Garbage Truck</option>
                            <option value="pickup_truck">Pickup Truck</option>
                            <option value="compact_truck">Compact Truck</option>
                            <option value="van">Van</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="licensePlate"><i class="fas fa-car"></i> License Plate</label>
                        <input type="text" id="licensePlate" name="licensePlate" required placeholder="e.g., ABC-123">
                    </div>
                    <div class="form-group">
                        <label for="capacity"><i class="fas fa-weight"></i> Capacity (kg)</label>
                        <input type="number" id="capacity" name="capacity" required placeholder="e.g., 5000" min="100" max="50000">
                    </div>
                    <div class="form-group">
                        <label for="fuelType"><i class="fas fa-gas-pump"></i> Fuel Type</label>
                        <select id="fuelType" name="fuelType" required>
                            <option value="">Select Fuel Type</option>
                            <option value="diesel">Diesel</option>
                            <option value="electric">Electric</option>
                            <option value="hybrid">Hybrid</option>
                            <option value="cng">CNG</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="yearManufactured"><i class="fas fa-calendar"></i> Year Manufactured</label>
                        <input type="number" id="yearManufactured" name="yearManufactured" required min="1990" max="2024" placeholder="e.g., 2020">
                    </div>
                    <div class="form-group">
                        <label for="vehicleStatus"><i class="fas fa-check-circle"></i> Status</label>
                        <select id="vehicleStatus" name="vehicleStatus" required>
                            <option value="active">Active</option>
                            <option value="maintenance">Under Maintenance</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="assignedDriver"><i class="fas fa-user"></i> Assigned Driver</label>
                        <select id="assignedDriver" name="assignedDriver">
                            <option value="">No Driver Assigned</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="vehicleNotes"><i class="fas fa-clipboard"></i> Notes</label>
                    <textarea id="vehicleNotes" name="vehicleNotes" placeholder="Additional notes about the vehicle..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeVehicleRegistrationModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Register Vehicle
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Bin Registration Modal -->
<div id="binRegistrationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-trash"></i> Register New Bin</h2>
            <span class="close" onclick="closeBinRegistrationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="binRegistrationForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="binId"><i class="fas fa-id-card"></i> Bin ID</label>
                        <input type="text" id="binId" name="binId" required placeholder="e.g., BIN-001">
                    </div>
                    <div class="form-group">
                        <label for="binType"><i class="fas fa-recycle"></i> Bin Type</label>
                        <select id="binType" name="binType" required>
                            <option value="">Select Type</option>
                            <option value="paper">Paper</option>
                            <option value="plastic">Plastic</option>
                            <option value="glass">Glass</option>
                            <option value="organic">Organic</option>
                            <option value="metal">Metal</option>
                            <option value="general">General Waste</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="binCapacity"><i class="fas fa-expand-arrows-alt"></i> Capacity (L)</label>
                        <input type="number" id="binCapacity" name="binCapacity" required placeholder="e.g., 240" min="50" max="1100">
                    </div>
                    <div class="form-group">
                        <label for="binLocation"><i class="fas fa-map-marker-alt"></i> Location</label>
                        <input type="text" id="binLocation" name="binLocation" required placeholder="e.g., Main Street Corner">
                    </div>
                    <div class="form-group">
                        <label for="binLatitude"><i class="fas fa-globe"></i> Latitude</label>
                        <input type="number" id="binLatitude" name="binLatitude" required step="0.000001" placeholder="e.g., 25.2854">
                    </div>
                    <div class="form-group">
                        <label for="binLongitude"><i class="fas fa-globe"></i> Longitude</label>
                        <input type="number" id="binLongitude" name="binLongitude" required step="0.000001" placeholder="e.g., 51.5310">
                    </div>
                    <div class="form-group">
                        <label for="sensorEnabled"><i class="fas fa-wifi"></i> IoT Sensor</label>
                        <select id="sensorEnabled" name="sensorEnabled" required>
                            <option value="true">Enabled</option>
                            <option value="false">Disabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="binNeighborhood"><i class="fas fa-building"></i> Neighborhood</label>
                        <input type="text" id="binNeighborhood" name="binNeighborhood" placeholder="e.g., Downtown">
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="binDescription"><i class="fas fa-clipboard"></i> Description</label>
                    <textarea id="binDescription" name="binDescription" placeholder="Additional details about the bin location..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeBinRegistrationModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Register Bin
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Issue Reporting Modal -->
<div id="issueReportingModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-triangle"></i> Report Issue</h2>
            <span class="close" onclick="closeIssueReportingModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="issueReportingForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="issueType"><i class="fas fa-tags"></i> Issue Type</label>
                        <select id="issueType" name="issueType" required>
                            <option value="">Select Issue Type</option>
                            <option value="bin_overflow">Bin Overflow</option>
                            <option value="bin_damage">Bin Damage</option>
                            <option value="missed_collection">Missed Collection</option>
                            <option value="vehicle_breakdown">Vehicle Breakdown</option>
                            <option value="route_obstruction">Route Obstruction</option>
                            <option value="safety_concern">Safety Concern</option>
                            <option value="equipment_malfunction">Equipment Malfunction</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="issuePriority"><i class="fas fa-exclamation"></i> Priority</label>
                        <select id="issuePriority" name="issuePriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="critical">Critical</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="issueLocation"><i class="fas fa-map-marker-alt"></i> Location</label>
                        <input type="text" id="issueLocation" name="issueLocation" required placeholder="e.g., Main Street, Downtown">
                    </div>
                    <div class="form-group">
                        <label for="relatedBin"><i class="fas fa-trash"></i> Related Bin (Optional)</label>
                        <select id="relatedBin" name="relatedBin">
                            <option value="">Select Bin (if applicable)</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="issueDescription"><i class="fas fa-edit"></i> Description</label>
                    <textarea id="issueDescription" name="issueDescription" required placeholder="Describe the issue in detail..." rows="4"></textarea>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="issueImage"><i class="fas fa-camera"></i> Attach Image (Optional)</label>
                    <input type="file" id="issueImage" name="issueImage" accept="image/*">
                    <small style="color: #94a3b8;">Upload an image to help explain the issue</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeIssueReportingModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-paper-plane"></i> Submit Report
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Error Logs Modal -->
<div id="errorLogsModal" class="modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 80vh;">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-triangle"></i> System Error Logs</h2>
            <span class="close" onclick="closeErrorLogsModal()">&times;</span>
        </div>
        <div class="modal-body" style="padding: 1.5rem;">
            <div style="margin-bottom: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <div style="color: #94a3b8;">
                    <i class="fas fa-info-circle"></i> 
                    Showing system errors with user context and timing
                </div>
                <button class="btn btn-sm btn-warning" onclick="clearErrorLogs()" style="font-size: 0.8rem;">
                    <i class="fas fa-trash"></i> Clear All Logs
                </button>
            </div>
            <div id="errorLogsList" style="max-height: 500px; overflow-y: auto;">
                <!-- Will be populated dynamically -->
            </div>
        </div>
    </div>
</div>

<!-- Complaint Registration Modal -->
<div id="complaintRegistrationModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
            <h2><i class="fas fa-exclamation-circle"></i> Register New Complaint</h2>
            <span class="close" onclick="closeComplaintRegistrationModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form id="complaintRegistrationForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="complaintType"><i class="fas fa-tags"></i> Complaint Type</label>
                        <select id="complaintType" name="complaintType" required>
                            <option value="">Select Complaint Type</option>
                            <option value="missed_collection">Missed Collection</option>
                            <option value="overflowing_bin">Overflowing Bin</option>
                            <option value="damaged_bin">Damaged Bin</option>
                            <option value="noise_complaint">Noise Complaint</option>
                            <option value="service_quality">Service Quality</option>
                            <option value="billing_issue">Billing Issue</option>
                            <option value="schedule_change">Schedule Change Request</option>
                            <option value="environmental_concern">Environmental Concern</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="complaintPriority"><i class="fas fa-exclamation"></i> Priority</label>
                        <select id="complaintPriority" name="complaintPriority" required>
                            <option value="">Select Priority</option>
                            <option value="low">Low</option>
                            <option value="medium">Medium</option>
                            <option value="high">High</option>
                            <option value="urgent">Urgent</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="complainantName"><i class="fas fa-user"></i> Your Name</label>
                        <input type="text" id="complainantName" name="complainantName" required placeholder="Full Name">
                    </div>
                    <div class="form-group">
                        <label for="complainantContact"><i class="fas fa-phone"></i> Contact Number</label>
                        <input type="tel" id="complainantContact" name="complainantContact" required placeholder="Phone Number">
                    </div>
                    <div class="form-group">
                        <label for="complainantEmail"><i class="fas fa-envelope"></i> Email (Optional)</label>
                        <input type="email" id="complainantEmail" name="complainantEmail" placeholder="Email Address">
                    </div>
                    <div class="form-group">
                        <label for="complaintLocation"><i class="fas fa-map-marker-alt"></i> Location/Address</label>
                        <input type="text" id="complaintLocation" name="complaintLocation" required placeholder="Specific address or location">
                    </div>
                    <div class="form-group">
                        <label for="complaintNeighborhood"><i class="fas fa-building"></i> Neighborhood</label>
                        <input type="text" id="complaintNeighborhood" name="complaintNeighborhood" placeholder="Neighborhood or district">
                    </div>
                    <div class="form-group">
                        <label for="relatedBinComplaint"><i class="fas fa-trash"></i> Related Bin (Optional)</label>
                        <select id="relatedBinComplaint" name="relatedBinComplaint">
                            <option value="">Select bin if applicable</option>
                            <!-- Will be populated dynamically -->
                        </select>
                    </div>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="complaintDescription"><i class="fas fa-edit"></i> Complaint Description</label>
                    <textarea id="complaintDescription" name="complaintDescription" required placeholder="Please describe the issue in detail..." rows="4"></textarea>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label for="complaintImage"><i class="fas fa-camera"></i> Attach Image (Optional)</label>
                    <input type="file" id="complaintImage" name="complaintImage" accept="image/*">
                    <small style="color: #94a3b8;">Upload an image to help explain the complaint</small>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeComplaintRegistrationModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">
                        <i class="fas fa-paper-plane"></i> Submit Complaint
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Complaint Details Modal -->
<div id="complaintDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2><i class="fas fa-file-alt"></i> Complaint Details</h2>
            <span class="close" onclick="closeComplaintDetailsModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Complaint Overview -->
            <div class="complaint-overview">
                <div class="complaint-badge-container">
                    <div class="complaint-type-badge" id="complaintTypeBadge">
                        <i class="fas fa-exclamation-circle"></i>
                        <span id="complaintTypeText">Loading...</span>
                    </div>
                    <div class="complaint-priority-badge" id="complaintPriorityBadge">
                        <i class="fas fa-flag"></i>
                        <span id="complaintPriorityText">Loading...</span>
                    </div>
                    <div class="complaint-status-badge" id="complaintStatusBadge">
                        <i class="fas fa-info-circle"></i>
                        <span id="complaintStatusText">Loading...</span>
                    </div>
                </div>
            </div>

            <!-- Complaint Information -->
            <div class="form-section-header">
                <i class="fas fa-info"></i>
                <span>Complaint Information</span>
            </div>

            <div class="complaint-details-grid">
                <div class="detail-item">
                    <label><i class="fas fa-hashtag"></i> Complaint ID</label>
                    <span id="complaintDetailsId">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-calendar"></i> Submitted Date</label>
                    <span id="complaintDetailsDate">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-map-marker-alt"></i> Location</label>
                    <span id="complaintDetailsLocation">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-building"></i> Neighborhood</label>
                    <span id="complaintDetailsNeighborhood">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-trash"></i> Related Bin</label>
                    <span id="complaintDetailsRelatedBin">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-clock"></i> Response Time</label>
                    <span id="complaintDetailsResponseTime">-</span>
                </div>
            </div>

            <!-- Description -->
            <div class="form-section-header">
                <i class="fas fa-edit"></i>
                <span>Description</span>
            </div>
            <div class="complaint-description">
                <p id="complaintDetailsDescription">Loading complaint description...</p>
            </div>

            <!-- Complainant Information -->
            <div class="form-section-header">
                <i class="fas fa-user"></i>
                <span>Complainant Information</span>
            </div>

            <div class="complainant-details-grid">
                <div class="detail-item">
                    <label><i class="fas fa-user"></i> Name</label>
                    <span id="complainantDetailsName">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-phone"></i> Contact</label>
                    <span id="complainantDetailsContact">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-envelope"></i> Email</label>
                    <span id="complainantDetailsEmail">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-user-shield"></i> Submitted By</label>
                    <span id="complainantDetailsSubmittedBy">-</span>
                </div>
            </div>

            <!-- Image Attachment -->
            <div class="form-section-header" id="imageAttachmentSection" style="display: none;">
                <i class="fas fa-image"></i>
                <span>Attached Image</span>
            </div>
            <div class="complaint-image-container" id="complaintImageContainer" style="display: none;">
                <div class="image-preview">
                    <img id="complaintDetailsImage" src="" alt="Complaint Image" />
                    <div class="image-overlay">
                        <button class="btn btn-secondary btn-sm" onclick="viewFullImage()">
                            <i class="fas fa-expand"></i> View Full Size
                        </button>
                    </div>
                </div>
                <p class="image-caption" id="complaintImageCaption">Attached complaint image</p>
            </div>

            <!-- Resolution Section (if resolved) -->
            <div class="form-section-header" id="resolutionSection" style="display: none;">
                <i class="fas fa-check-circle"></i>
                <span>Resolution</span>
            </div>
            <div class="resolution-details" id="resolutionDetails" style="display: none;">
                <div class="detail-item">
                    <label><i class="fas fa-calendar-check"></i> Resolved Date</label>
                    <span id="complaintResolvedDate">-</span>
                </div>
                <div class="detail-item">
                    <label><i class="fas fa-user-cog"></i> Resolved By</label>
                    <span id="complaintResolvedBy">-</span>
                </div>
                <div class="resolution-description">
                    <label><i class="fas fa-comment"></i> Resolution Notes</label>
                    <p id="complaintResolutionNotes">-</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeComplaintDetailsModal()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-warning" id="editComplaintBtn" onclick="editComplaint()">
                    <i class="fas fa-edit"></i> Edit Complaint
                </button>
                <button class="btn btn-success" id="resolveComplaintBtn" onclick="resolveComplaintFromDetails()">
                    <i class="fas fa-check"></i> Mark as Resolved
                </button>
                <button class="btn btn-info" onclick="printComplaintDetails()">
                    <i class="fas fa-print"></i> Print Details
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Full Image Modal -->
<div id="fullImageModal" class="modal">
    <div class="modal-content" style="max-width: 90%; max-height: 90%; padding: 0; background: transparent; border: none; box-shadow: none;">
        <div class="full-image-container">
            <span class="close" onclick="closeFullImageModal()" style="position: absolute; top: 20px; right: 20px; z-index: 2001; background: rgba(0,0,0,0.8); color: white; border-radius: 50%; width: 50px; height: 50px;">&times;</span>
            <img id="fullSizeImage" src="" alt="Full Size Complaint Image" style="max-width: 100%; max-height: 100%; object-fit: contain; border-radius: 12px;" />
        </div>
    </div>
</div>

<!-- Smart Assignment Modal -->
<div id="customModal" class="modal" style="z-index: 10001;">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; background: #0f172a; border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 20px;">
        <div id="modalBody" style="padding: 0; border-radius: 20px;">
            <!-- Smart assignment content will be inserted here -->
        </div>
    </div>
</div>

<!-- Driver Details Modal -->
<div id="driverDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 1000px;">
        <div class="modal-header">
            <h2><i class="fas fa-user-circle"></i> Driver Details & History</h2>
            <span class="close" onclick="closeDriverDetailsModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Driver Overview -->
            <div class="driver-overview-section">
                <div class="driver-profile-header">
                    <div class="driver-avatar-large" id="driverAvatarLarge">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="driver-basic-info">
                        <h3 id="driverDetailsName">Loading...</h3>
                        <p id="driverDetailsId">ID: Loading...</p>
                        <div class="driver-status-badges">
                            <span class="status-badge" id="driverLiveStatus">Online</span>
                            <span class="vehicle-badge" id="driverVehicleInfo">Vehicle: Loading...</span>
                        </div>
                    </div>
                    <div class="driver-quick-stats">
                        <div class="stat-item">
                            <i class="fas fa-road"></i>
                            <span id="driverTotalTrips">0</span>
                            <small>Total Trips</small>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-trash"></i>
                            <span id="driverTotalCollections">0</span>
                            <small>Collections</small>
                        </div>
                        <div class="stat-item">
                            <i class="fas fa-gas-pump"></i>
                            <span id="driverFuelLevelModal">75%</span>
                            <small>Fuel Level</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Status Section -->
            <div class="form-section-header">
                <i class="fas fa-satellite-dish"></i>
                <span>Live Status & Location</span>
            </div>
            
            <div class="driver-live-status">
                <div class="status-grid">
                    <div class="status-item">
                        <label><i class="fas fa-circle"></i> Current Status</label>
                        <span id="driverCurrentStatus" class="status-indicator">Active</span>
                    </div>
                    <div class="status-item">
                        <label><i class="fas fa-map-marker-alt"></i> Last Location</label>
                        <span id="driverLastLocation">Loading...</span>
                    </div>
                    <div class="status-item">
                        <label><i class="fas fa-clock"></i> Last Update</label>
                        <span id="driverLastUpdate">Just now</span>
                    </div>
                    <div class="status-item">
                        <label><i class="fas fa-route"></i> Current Route</label>
                        <span id="driverCurrentRoute">No active route</span>
                    </div>
                </div>
                
                <div class="fuel-status-section">
                    <label><i class="fas fa-gas-pump"></i> Fuel Status</label>
                    <div class="fuel-gauge">
                        <div class="fuel-bar">
                            <div class="fuel-level" id="driverFuelBar" style="width: 75%;"></div>
                        </div>
                        <span id="driverFuelPercentage">75%</span>
                    </div>
                    <button class="btn btn-warning btn-sm" onclick="updateDriverFuel()">
                        <i class="fas fa-edit"></i> Update Fuel Level
                    </button>
                </div>
            </div>

            <!-- Today's Activity -->
            <div class="form-section-header">
                <i class="fas fa-calendar-day"></i>
                <span>Today's Activity</span>
            </div>
            
            <div class="today-activity-grid">
                <div class="activity-metric">
                    <i class="fas fa-check-circle"></i>
                    <span id="todayCollectionsCount">0</span>
                    <small>Collections Today</small>
                </div>
                <div class="activity-metric">
                    <i class="fas fa-road"></i>
                    <span id="todayDistance">0 km</span>
                    <small>Distance Covered</small>
                </div>
                <div class="activity-metric">
                    <i class="fas fa-clock"></i>
                    <span id="todayWorkingTime">0h 0m</span>
                    <small>Working Time</small>
                </div>
                <div class="activity-metric">
                    <i class="fas fa-star"></i>
                    <span id="todayEfficiency">100%</span>
                    <small>Efficiency</small>
                </div>
            </div>

            <!-- Recent Trips History -->
            <div class="form-section-header">
                <i class="fas fa-history"></i>
                <span>Recent Trips & Collections</span>
            </div>
            
            <div class="driver-trips-history" id="driverTripsHistory">
                <!-- Will be populated dynamically -->
            </div>

            <!-- Performance Chart -->
            <div class="form-section-header">
                <i class="fas fa-chart-line"></i>
                <span>Performance Trends</span>
            </div>
            
            <div class="driver-performance-chart-container">
                <canvas id="driverPerformanceTrendChart" width="400" height="200"></canvas>
            </div>

            <!-- 💬 MANAGEMENT MESSAGING INTERFACE - Real-time Chat with Driver -->
            <div class="form-section-header">
                <h3><i class="fas fa-comments"></i> Driver Communication</h3>
                <p>Send messages and make calls to communicate with the driver in real-time</p>
            </div>
            
            <div class="management-messaging-system">
                <!-- Communication Header -->
                <div class="communication-header">
                    <div class="driver-online-status">
                        <div class="status-indicator online" id="driverOnlineStatus"></div>
                        <span id="driverOnlineText">Driver Online</span>
                        <small id="lastSeenTime">Last seen: Just now</small>
                    </div>
                    <div class="communication-actions">
                        <button class="comm-action-btn call" onclick="callDriver()" id="callDriverBtn">
                            <i class="fas fa-phone"></i>
                            <span>Call Driver</span>
                        </button>
                        <button class="comm-action-btn video" onclick="startVideoCall()" id="videoCallBtn">
                            <i class="fas fa-video"></i>
                            <span>Video Call</span>
                        </button>
                    </div>
                </div>
                
                <!-- Messages History -->
                <div class="admin-messages-container" id="adminMessagesContainer">
                    <div class="messages-history" id="adminMessagesHistory">
                        <!-- Messages will be populated here -->
                        <div class="no-messages-state">
                            <i class="fas fa-comment-dots"></i>
                            <p>No messages yet</p>
                            <small>Start a conversation with the driver</small>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Message Input -->
                <div class="admin-message-input-container">
                    <div class="admin-message-input-wrapper">
                        <textarea id="adminMessageInput" 
                                  placeholder="Type your message to the driver..." 
                                  maxlength="1000"
                                  rows="3"
                                  autocomplete="off"></textarea>
                        <div class="admin-message-actions">
                            <button class="admin-tool-btn" onclick="attachFileToMessage()" title="Attach File">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button class="admin-tool-btn" onclick="sendLocationToDriver()" title="Send Location">
                                <i class="fas fa-map-marker-alt"></i>
                            </button>
                            <button class="admin-tool-btn priority" onclick="sendPriorityMessage()" title="Priority Message">
                                <i class="fas fa-star"></i>
                            </button>
                            <button class="admin-send-btn" onclick="sendAdminMessage()" id="adminSendBtn" disabled>
                                <i class="fas fa-paper-plane"></i>
                                Send
                            </button>
                        </div>
                    </div>
                    
                    <!-- Admin Quick Messages -->
                    <div class="admin-quick-messages">
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Please proceed to your next route')">
                            📍 Proceed to next route
                        </button>
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Emergency: Return to depot immediately')">
                            🚨 Return to depot
                        </button>
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Break approved - 30 minutes')">
                            ☕ Break approved
                        </button>
                        <button class="admin-quick-btn" onclick="sendAdminQuickMessage('Good job! Keep up the excellent work')">
                            👍 Good job!
                        </button>
                    </div>
                </div>
                
                <!-- Message Statistics -->
                <div class="message-statistics">
                    <div class="stat-item">
                        <i class="fas fa-envelope"></i>
                        <span id="totalMessagesCount">0</span>
                        <label>Total Messages</label>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <span id="avgResponseTime">-</span>
                        <label>Avg Response</label>
                    </div>
                    <div class="stat-item">
                        <i class="fas fa-phone"></i>
                        <span id="totalCallsCount">0</span>
                        <label>Total Calls</label>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeDriverDetailsModal()">
                    <i class="fas fa-times"></i> Close
                </button>
                <button class="btn btn-success" onclick="refreshDriverDetailsModal()" title="Refresh driver data in real-time">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
                <button class="btn btn-primary" onclick="assignRouteToDriver(currentDriverDetailsId)">
                    <i class="fas fa-route"></i> Assign Route
                </button>
                <button class="btn btn-info" onclick="contactDriver()">
                    <i class="fas fa-phone"></i> Contact Driver
                </button>
                <button class="btn btn-warning" onclick="sendDriverMessage()">
                    <i class="fas fa-comment"></i> Send Message
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Route Assignment Modal -->
<div id="routeAssignmentModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2><i class="fas fa-route"></i> Smart Route Assignment</h2>
            <span class="close" onclick="closeRouteAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Driver Information -->
            <div class="form-section-header">
                <i class="fas fa-user"></i>
                <span>Driver Information</span>
            </div>
            
            <div id="routeAssignmentDriverInfo" class="route-driver-info">
                <!-- Will be populated dynamically -->
            </div>

            <!-- AI Recommendations -->
            <div class="form-section-header">
                <i class="fas fa-brain"></i>
                <span>🤖 AI Recommendations</span>
            </div>
            
            <div class="ai-recommendations-section">
                <div class="ai-recommendation-header">
                    <div class="ai-brain-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div class="ai-text">
                        <p>Based on distance, fill levels, and priority, here are the smartest collection suggestions:</p>
                    </div>
                </div>
                
                <div id="aiRecommendedBins" class="recommended-bins-grid">
                    <!-- Will be populated with AI suggestions -->
                </div>
            </div>

            <!-- Available Bins -->
            <div class="form-section-header">
                <i class="fas fa-trash"></i>
                <span>All Available Bins</span>
            </div>
            
            <div class="bins-selection-container">
                <div class="search-filter-bar">
                    <input type="text" id="binSearchInput" placeholder="Search bins by ID or location..." class="form-input">
                    <select id="binFilterSelect" class="form-input">
                        <option value="all">All Bins</option>
                        <option value="high-priority">High Priority (>75%)</option>
                        <option value="medium-priority">Medium Priority (50-75%)</option>
                        <option value="low-priority">Low Priority (<50%)</option>
                    </select>
                </div>
                
                <div id="availableBinsList" class="available-bins-list">
                    <!-- Will be populated dynamically -->
                </div>
            </div>

            <!-- Selected Bins Summary -->
            <div class="form-section-header">
                <i class="fas fa-check-circle"></i>
                <span>Selected Route Summary</span>
            </div>
            
            <div class="selected-route-summary">
                <div class="route-metrics">
                    <div class="metric">
                        <i class="fas fa-trash"></i>
                        <span id="selectedBinsCount">0</span>
                        <small>Bins Selected</small>
                    </div>
                    <div class="metric">
                        <i class="fas fa-route"></i>
                        <span id="estimatedDistance">0 km</span>
                        <small>Total Distance</small>
                    </div>
                    <div class="metric">
                        <i class="fas fa-clock"></i>
                        <span id="estimatedTime">0 min</span>
                        <small>Estimated Time</small>
                    </div>
                    <div class="metric">
                        <i class="fas fa-gas-pump"></i>
                        <span id="estimatedFuel">0 L</span>
                        <small>Fuel Needed</small>
                    </div>
                </div>
                
                <div id="selectedBinsPreview" class="selected-bins-preview">
                    <p style="text-align: center; color: #94a3b8; padding: 2rem;">No bins selected yet. Choose from AI recommendations or browse all available bins above.</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="closeRouteAssignmentModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-warning" onclick="clearSelectedBins()">
                    <i class="fas fa-eraser"></i> Clear Selection
                </button>
                <button class="btn btn-info" onclick="useAIRecommendations()">
                    <i class="fas fa-brain"></i> Use AI Suggestions
                </button>
                <button class="btn btn-success" onclick="confirmRouteAssignment()" id="confirmAssignmentBtn" disabled>
                    <i class="fas fa-check"></i> Assign Route
                </button>
            </div>
        </div>
        </div>
    </div>

    <!-- Application Scripts - Load in correct order with AI/ML Enhancement -->
    
    <!-- Core System -->
    <script src="data-manager.js"></script>
    <script src="sync-manager.js"></script>
    <script src="auth.js"></script>
    
    <!-- AI/ML Engine Layer -->
    <script src="advanced-ai-engine.js"></script>
    <script src="predictive-analytics.js"></script>
    <script src="ml-route-optimizer.js"></script>
    <script src="intelligent-driver-assistant.js"></script>
    
    <!-- AI Integration Layer -->
    <script src="ai-driver-integration.js"></script>
    <script src="ai-integration-bridge.js"></script>
    
    <!-- Enhanced Analytics -->
    <script src="enhanced-analytics.js"></script>
    <script src="analytics-manager-v2.js"></script>
    <script src="ai-chart-visualizer.js"></script>
    <script src="ai-analytics-integration.js"></script>
    
    <!-- Application Layer -->
    <script src="map-manager.js"></script>
    <script src="bin-modals.js"></script>
    <script src="driver-system-v3.js"></script>
    <script src="enhanced-driver-buttons-new.js"></script>
    <script src="websocket-manager.js"></script>
    <script src="messaging-system.js"></script>
    
    <!-- Enhanced Messaging System -->
    <script src="enhanced-messaging-system.js"></script>
    
    <script src="app.js"></script>
    <script src="event-handlers.js"></script>
    
    <!-- Comprehensive Driver & Map Integration Fix -->
    <script>
        // Comprehensive System Integration and Initialization Fix
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 Starting COMPLETE system integration and fixes...');
            
            // Phase 1: Force critical system initialization
            function initializeCriticalSystems() {
                // Force data manager demo user creation
                if (window.dataManager) {
                    console.log('🔧 Force initializing demo users...');
                    window.dataManager.initializeDefaultData();
                    
                    // Verify users were created
                    const users = window.dataManager.getUsers();
                    console.log('✅ Available users after initialization:', users.map(u => u.username + ' (' + u.type + ')'));
                    
                    if (users.length === 0) {
                        console.warn('⚠️ No users found, forcing creation...');
                        window.dataManager.setData('initialized', false);
                        window.dataManager.initializeDefaultData();
                    }
                }
                
                // Show demo account info to user
                setTimeout(() => {
                    const demoInfo = document.createElement('div');
                    demoInfo.id = 'demo-account-info';
                    demoInfo.style.cssText = `
                        position: fixed; 
                        top: 20px; 
                        right: 20px; 
                        background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%); 
                        color: white; 
                        padding: 15px 20px; 
                        border-radius: 10px; 
                        box-shadow: 0 4px 20px rgba(0,0,0,0.3); 
                        z-index: 10001; 
                        max-width: 300px; 
                        font-size: 12px; 
                        line-height: 1.4;
                        font-family: system-ui;
                    `;
                    demoInfo.innerHTML = `
                        <div style="font-weight: bold; margin-bottom: 8px; color: #fbbf24;">🔐 Demo Accounts Available:</div>
                        <div><strong>Admin:</strong> admin / admin123</div>
                        <div><strong>Manager:</strong> manager1 / manager123</div>
                        <div><strong>Driver:</strong> driver1 / driver123</div>
                        <div><strong>Driver:</strong> driver2 / driver123</div>
                        <div style="margin-top: 8px; color: #94a3b8; font-size: 10px;">Click anywhere to dismiss</div>
                    `;
                    
                    demoInfo.onclick = () => demoInfo.remove();
                    document.body.appendChild(demoInfo);
                    
                    // Auto remove after 15 seconds
                    setTimeout(() => {
                        if (demoInfo.parentNode) demoInfo.remove();
                    }, 15000);
                }, 2000);
            }
            
            // Phase 2: Wait for all systems to be available
            function waitForSystems() {
                if (typeof window.mapManager !== 'undefined' && 
                    typeof window.enhancedDriverButtons !== 'undefined' && 
                    typeof window.authManager !== 'undefined' &&
                    typeof window.dataManager !== 'undefined') {
                    
                    console.log('✅ All critical systems loaded, performing integration...');
                    
                    // Initialize critical systems
                    initializeCriticalSystems();
                    
                    // Phase 3: Enhanced Map Initialization - CRITICAL DIMENSION FORCING
                    setTimeout(() => {
                        console.log('🗺️ Starting CRITICAL map dimension forcing...');
                        
                        // FORCE MAP CONTAINER DIMENSIONS AT MULTIPLE LEVELS
                        const mapContainer = document.getElementById('map');
                        const mapParent = mapContainer ? mapContainer.closest('.map-container') : null;
                        const contentSection = mapContainer ? mapContainer.closest('.content-section') : null;
                        
                        if (mapContainer) {
                            console.log('🔧 FORCING map container dimensions at ALL levels...');
                            
                            // Force parent container dimensions
                            if (mapParent) {
                                mapParent.style.cssText += `
                                    width: 100% !important; 
                                    height: 600px !important; 
                                    min-height: 600px !important;
                                    display: grid !important;
                                    position: absolute !important;
                                    top: -10000px !important;
                                    left: -10000px !important;
                                    visibility: hidden !important;
                                `;
                            }
                            
                            // Force content section to be present but hidden
                            if (contentSection) {
                                contentSection.style.cssText += `
                                    display: block !important;
                                    visibility: hidden !important;
                                    position: absolute !important;
                                    top: -10000px !important;
                                    left: -10000px !important;
                                `;
                            }
                            
                            // CRITICAL: Force map element dimensions
                            const originalStyle = mapContainer.style.cssText;
                            mapContainer.style.cssText = `
                                width: 800px !important; 
                                height: 600px !important; 
                                min-width: 800px !important;
                                min-height: 600px !important;
                                max-width: 800px !important;
                                max-height: 600px !important;
                                display: block !important; 
                                position: relative !important; 
                                visibility: hidden !important;
                                z-index: 1 !important;
                            `;
                            
                            // Wait for DOM to apply styles
                            setTimeout(() => {
                                // Verify dimensions are actually applied
                                const rect = mapContainer.getBoundingClientRect();
                                console.log('🔍 Map dimensions after forcing:', {
                                    width: rect.width,
                                    height: rect.height,
                                    computed: window.getComputedStyle(mapContainer)
                                });
                                
                                // Initialize map with VERIFIED dimensions
                                if (window.mapManager && !window.mapManager.map) {
                                    console.log('🗺️ Initializing map with VERIFIED dimensions...');
                                    const mapInstance = window.mapManager.initializeMainMap('map');
                                
                                    if (mapInstance) {
                                        console.log('✅ Map initialized successfully');
                                        
                                        // Restore original styling AFTER successful initialization
                                        setTimeout(() => {
                                            mapContainer.style.cssText = originalStyle;
                                            if (mapParent) mapParent.style.cssText = '';
                                            if (contentSection) contentSection.style.cssText = '';
                                            
                                            if (window.mapManager.map && typeof window.mapManager.map.invalidateSize === 'function') {
                                                window.mapManager.map.invalidateSize();
                                                console.log('🔄 Map size invalidated and restored');
                                            }
                                        }, 200);
                                    } else {
                                        console.warn('⚠️ Map initialization failed, using fallback');
                                        mapContainer.style.cssText = originalStyle;
                                        if (mapParent) mapParent.style.cssText = '';
                                        if (contentSection) contentSection.style.cssText = '';
                                    }
                                }
                            }, 100); // End dimension verification timeout
                        }
                        
                        // Update driver count display
                        const activeDrivers = window.dataManager?.getDrivers?.() || [];
                        const driverCount = document.getElementById('activeDriverCount');
                        if (driverCount) {
                            driverCount.textContent = activeDrivers.length;
                            console.log(`📊 Updated driver count display: ${activeDrivers.length}`);
                        }
                        
                        // Refresh driver buttons state
                        if (window.enhancedDriverButtons) {
                            window.enhancedDriverButtons.checkUserStatus();
                            console.log('🔄 Refreshed driver buttons state');
                        }
                        
                        // Final system health check
                        setTimeout(() => {
                            console.log('🔍 Final system health check...');
                            const systems = {
                                'Data Manager': !!window.dataManager,
                                'Map Manager': !!window.mapManager,
                                'Auth Manager': !!window.authManager,
                                'Enhanced Buttons': !!window.enhancedDriverButtons,
                                'Analytics Manager': !!window.analyticsManagerV2,
                                'AI Integration': !!window.aiIntegrationBridge
                            };
                            
                            console.table(systems);
                            console.log('✅ COMPLETE system integration finished!');
                        }, 500);
                        
                    }, 1000);
                    
                } else {
                    console.log('⏳ Waiting for critical systems to load...');
                    setTimeout(waitForSystems, 100);
                }
            }
            
            // Start the initialization process
            waitForSystems();
        });
    </script>
    
    <!-- AI Integration Script -->
    <script>
        // Initialize AI integration after all components are loaded
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🧠 Initializing World-Class AI Integration...');
            
            // Wait for all AI components to be available
            setTimeout(() => {
                if (window.advancedAI && window.predictiveAnalytics && 
                    window.mlRouteOptimizer && window.intelligentDriverAssistant) {
                    
                    console.log('✅ All AI components loaded successfully');
                    console.log('🎯 AI Capabilities:');
                    console.log('   - Advanced Route Optimization with ML');
                    console.log('   - Predictive Analytics & Forecasting');
                    console.log('   - Intelligent Driver Assistant');
                    console.log('   - Real-time Anomaly Detection');
                    console.log('   - Computer Vision Analytics');
                    console.log('   - Natural Language Processing');
                    console.log('   - Deep Learning Insights');
                    console.log('🚀 World-Class Waste Management AI System Ready!');
                    
                    // Dispatch AI ready event
                    document.dispatchEvent(new CustomEvent('aiSystemReady', {
                        detail: {
                            components: ['advancedAI', 'predictiveAnalytics', 'mlRouteOptimizer', 'intelligentDriverAssistant'],
                            capabilities: [
                                'route_optimization', 'predictive_analytics', 'driver_assistance',
                                'anomaly_detection', 'computer_vision', 'nlp', 'deep_learning'
                            ]
                        }
                    }));
                    
                } else {
                    console.warn('⚠️ Some AI components failed to load, using fallback functionality');
                }
            }, 2000);
        });
    </script>

<!-- Bin Details Modal with 3D Visualization -->
<div id="binDetailsModal" class="modal">
    <div class="modal-content" style="max-width: 1200px;">
        <div class="modal-header">
            <h2 id="modalBinTitle">Paper Bin Details</h2>
            <span class="close" onclick="closeBinDetailsModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Visual Bin Representation -->
            <div class="bin-visual-container">
                <div class="bin-3d-visual">
                    <div class="bin-3d">
                        <div class="bin-body">
                            <div class="bin-fill-level" id="binFillVisual">
                                <span id="fillPercentText">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="circular-progress">
                    <svg viewBox="0 0 200 200">
                        <defs>
                            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:var(--primary);stop-opacity:1" />
                                <stop offset="100%" style="stop-color:var(--primary-dark);stop-opacity:1" />
                            </linearGradient>
                        </defs>
                        <circle class="progress-circle-bg" cx="100" cy="100" r="80"/>
                        <circle class="progress-circle" id="progressCircle" cx="100" cy="100" r="80"
                                stroke-dasharray="502.4" stroke-dashoffset="502.4"/>
                    </svg>
                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                        <div style="font-size: 2rem; font-weight: bold;" id="circularFillText">0%</div>
                        <div style="font-size: 0.875rem; color: #94a3b8;">Fill Level</div>
                    </div>
                </div>
            </div>

            <!-- AI Prediction with Visual -->
            <div class="ai-prediction-container">
                <div class="ai-header">
                    <div class="ai-icon">
                        <i class="fas fa-brain"></i>
                    </div>
                    <div>
                        <h3 style="margin: 0;">AI Prediction Engine</h3>
                        <p style="margin: 0; color: #94a3b8; font-size: 0.875rem;">Machine Learning Analysis</p>
                    </div>
                </div>
                
                <div class="prediction-visual">
                    <div class="prediction-card">
                        <i class="fas fa-clock" style="font-size: 2rem; color: var(--primary); margin-bottom: 0.5rem;"></i>
                        <div class="prediction-value" id="timeToFull">--</div>
                        <div class="stat-label">Time to Full</div>
                    </div>
                    <div class="prediction-card">
                        <i class="fas fa-tachometer-alt" style="font-size: 2rem; color: var(--secondary); margin-bottom: 0.5rem;"></i>
                        <div class="prediction-value" id="fillRate">--</div>
                        <div class="stat-label">Fill Rate/Hour</div>
                    </div>
                    <div class="prediction-card">
                        <i class="fas fa-calendar-check" style="font-size: 2rem; color: var(--warning); margin-bottom: 0.5rem;"></i>
                        <div class="prediction-value" id="optimalCollection">--</div>
                        <div class="stat-label">Optimal Collection</div>
                    </div>
                </div>
            </div>

            <!-- Sensor Information -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem;">Sensor Information</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                        <div class="job-detail">
                            <i class="fas fa-microchip"></i>
                            <span>DF703 Ultrasonic Sensor</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-battery-three-quarters"></i>
                            <span id="modalBattery">Battery: 85%</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-signal"></i>
                            <span id="modalSignal">Signal: -75 dBm</span>
                        </div>
                    </div>
                    <div>
                        <div class="job-detail">
                            <i class="fas fa-thermometer-half"></i>
                            <span id="modalTemp">Temperature: 35°C</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-angle-double-down"></i>
                            <span id="modalTilt">Tilt: 2°</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-tools"></i>
                            <span id="modalMaintenance">Last Service: 15 days ago</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Environmental Impact -->
            <div class="environmental-impact">
                <h3 style="margin-bottom: 1rem;">Environmental Impact</h3>
                <div class="impact-grid">
                    <div class="impact-item">
                        <div class="impact-icon">🌳</div>
                        <div class="metric-value" id="treesEquivalent">0</div>
                        <div class="metric-label">Trees Saved</div>
                    </div>
                    <div class="impact-item">
                        <div class="impact-icon">💧</div>
                        <div class="metric-value" id="waterSaved">0 L</div>
                        <div class="metric-label">Water</div>
                    </div>
                    <div class="impact-item">
                        <div class="impact-icon">⚡</div>
                        <div class="metric-value" id="energySaved">0 kWh</div>
                        <div class="metric-label">Energy</div>
                    </div>
                    <div class="impact-item">
                        <div class="impact-icon">🌍</div>
                        <div class="metric-value" id="co2Saved">0 kg</div>
                        <div class="metric-label">CO2</div>
                    </div>
                </div>
            </div>

            <!-- Collection Patterns & History -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem;">Collection Patterns</h3>
                <canvas id="binHistoryChart" style="max-height: 200px;"></canvas>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; margin-top: 2rem; flex-wrap: wrap;">
                <button class="btn btn-danger" onclick="showDriverAssignmentModal()">
                    <i class="fas fa-user-plus"></i>
                    Assign Driver
                </button>
                <button class="btn btn-primary" onclick="scheduleCollection()">
                    <i class="fas fa-calendar-plus"></i>
                    Schedule Collection
                </button>
                <button class="btn btn-success" onclick="markBinCollected(binModalManager.currentBin.id)">
                    <i class="fas fa-check"></i>
                    Mark as Collected
                </button>
                <button class="btn btn-info" onclick="showBinHistoryModal()">
                    <i class="fas fa-history"></i>
                    Bin History
                </button>
                <button class="btn btn-secondary" onclick="reportBinIssue()">
                    <i class="fas fa-exclamation-triangle"></i>
                    Report Issue
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Driver Assignment Modal -->
<div id="driverAssignmentModal" class="modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <h2>Assign Driver to Bin</h2>
            <span class="close" onclick="closeDriverAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Bin Info -->
            <div class="glass-card" style="background: rgba(0, 212, 255, 0.05);">
                <h3 style="margin-bottom: 1rem;">Bin Information</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                        <div class="job-detail">
                            <i class="fas fa-trash"></i>
                            <span id="assignBinId">Bin ID</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-map-marker-alt"></i>
                            <span id="assignBinLocation">Location</span>
                        </div>
                    </div>
                    <div>
                        <div class="job-detail">
                            <i class="fas fa-percentage"></i>
                            <span id="assignBinFill">Fill Level</span>
                        </div>
                        <div class="job-detail">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span id="assignBinPriority">Priority</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Recommendation -->
            <div id="aiRecommendation" class="recommendation-banner" style="display: none;">
                <i class="fas fa-lightbulb"></i>
                <span id="recommendationText"></span>
                <button class="btn btn-success btn-sm" onclick="quickAssignRecommended()">
                    <i class="fas fa-bolt"></i> Quick Assign
                </button>
            </div>

            <!-- Driver List -->
            <div class="glass-card" style="background: rgba(124, 58, 237, 0.05);">
                <h3 style="margin-bottom: 1rem;">Available Drivers</h3>
                <div id="driverAssignmentList" class="driver-assignment-list">
                    <!-- Drivers will be populated here -->
                </div>
            </div>

            <!-- Selected Driver Preview -->
            <div id="selectedDriverPreview" class="glass-card" style="background: rgba(16, 185, 129, 0.05); display: none;">
                <h3 style="margin-bottom: 1rem;">Selected Driver</h3>
                <div id="selectedDriverInfo">
                    <!-- Selected driver info will appear here -->
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button class="btn btn-success" onclick="confirmDriverAssignment()">
                        <i class="fas fa-check"></i> Confirm Assignment
                    </button>
                    <button class="btn btn-secondary" onclick="cancelDriverSelection()">
                        <i class="fas fa-times"></i> Cancel Selection
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Simple Route Assignment Modal (Legacy) -->
<div id="simpleRouteAssignmentModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
        <div class="modal-header">
            <h2>Assign Route to Driver</h2>
            <span class="close" onclick="closeSimpleRouteAssignmentModal()">&times;</span>
        </div>
        <div class="modal-body">
            <!-- Driver Info -->
            <div class="glass-card" style="background: rgba(0, 212, 255, 0.05); margin-bottom: 1rem;">
                <h3 style="margin-bottom: 1rem;">Driver Information</h3>
                <div id="routeAssignmentDriverInfo">
                    <!-- Driver info will be populated here -->
                </div>
            </div>

            <!-- AI Recommendation -->
            <div id="routeAIRecommendation" class="recommendation-banner" style="display: none; margin-bottom: 1rem;">
                <i class="fas fa-lightbulb"></i>
                <span id="routeRecommendationText"></span>
                <button class="btn btn-success btn-sm" onclick="assignRecommendedBins()">
                    <i class="fas fa-bolt"></i> Assign All Recommended
                </button>
            </div>

            <!-- Available Bins -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem;">Available Bins for Collection</h3>
                <div id="availableBinsList" style="max-height: 400px; overflow-y: auto;">
                    <!-- Bins will be populated here -->
                </div>
            </div>

            <!-- Selected Bins -->
            <div class="glass-card" style="margin-top: 1rem;">
                <h3 style="margin-bottom: 1rem;">Selected Bins for Route</h3>
                <div id="selectedBinsList">
                    <p style="text-align: center; color: #94a3b8;">No bins selected</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeSimpleRouteAssignmentModal()">
                    <i class="fas fa-times"></i> Cancel
                </button>
                <button class="btn btn-primary" onclick="confirmSimpleRouteAssignment()">
                    <i class="fas fa-check"></i> Confirm Assignment
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Bin History Modal -->
<div id="binHistoryModal" class="modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <h2 style="margin: 0; color: #1e40af;">
                <i class="fas fa-history"></i>
                Bin Collection History
            </h2>
            <span class="close" onclick="closeBinHistoryModal()">&times;</span>
        </div>
        
        <div style="padding: 2rem;">
            <!-- Bin Information Header -->
            <div id="binHistoryHeader" class="glass-card" style="margin-bottom: 1.5rem;">
                <!-- Will be populated dynamically -->
            </div>
            
            <!-- Collection History -->
            <div class="glass-card" style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem; color: #059669;">
                    <i class="fas fa-trash-alt"></i> Collection History
                </h3>
                <div id="collectionHistoryList">
                    <p style="text-align: center; color: #94a3b8;">Loading collection history...</p>
                </div>
            </div>
            
            <!-- Sensor History -->
            <div class="glass-card" style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem; color: #7c3aed;">
                    <i class="fas fa-chart-line"></i> Sensor History
                </h3>
                <div id="sensorHistoryList">
                    <p style="text-align: center; color: #94a3b8;">Loading sensor history...</p>
                </div>
            </div>
            
            <!-- History Chart -->
            <div class="glass-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h3 style="margin: 0; color: #dc2626;">
                        <i class="fas fa-chart-area"></i> Fill Level Trends
                    </h3>
                    <button class="btn btn-sm btn-secondary" onclick="generateSampleBinTrend(binModalManager.currentBin.id)" style="font-size: 0.8rem;">
                        <i class="fas fa-flask"></i> Generate Sample Data
                    </button>
                </div>
                <div style="background: rgba(0, 0, 0, 0.2); padding: 0.5rem; border-radius: 6px; margin-bottom: 1rem;">
                    <div style="display: flex; gap: 1rem; font-size: 0.8rem;">
                        <span style="color: #dc2626;"><i class="fas fa-circle"></i> Collections</span>
                        <span style="color: #f59e0b;"><i class="fas fa-circle"></i> Pre-Collection</span>
                        <span style="color: #10b981;"><i class="fas fa-circle"></i> Current Status</span>
                        <span style="color: #3b82f6;"><i class="fas fa-circle"></i> Sensor Readings</span>
                    </div>
                </div>
                <canvas id="binHistoryDetailChart" style="max-height: 350px;"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Driver History Modal -->
<div id="driverHistoryModal" class="modal">
    <div class="modal-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
        <div class="modal-header">
            <h2 style="margin: 0; color: #1e40af;">
                <i class="fas fa-user-clock"></i>
                My Collection History
            </h2>
            <span class="close" onclick="closeDriverHistoryModal()">&times;</span>
        </div>
        
        <div style="padding: 2rem;">
            <!-- Driver Stats Header -->
            <div id="driverHistoryHeader" class="glass-card" style="margin-bottom: 1.5rem;">
                <!-- Will be populated dynamically -->
            </div>
            
            <!-- Collection Timeline -->
            <div class="glass-card" style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem; color: #059669;">
                    <i class="fas fa-timeline"></i> Collection Timeline
                </h3>
                <div id="driverCollectionTimeline">
                    <p style="text-align: center; color: #94a3b8;">Loading collection timeline...</p>
                </div>
            </div>
            
            <!-- Route History -->
            <div class="glass-card" style="margin-bottom: 1.5rem;">
                <h3 style="margin-bottom: 1rem; color: #7c3aed;">
                    <i class="fas fa-route"></i> Completed Routes
                </h3>
                <div id="driverRouteHistory">
                    <p style="text-align: center; color: #94a3b8;">Loading route history...</p>
                </div>
            </div>
            
            <!-- Performance Chart -->
            <div class="glass-card">
                <h3 style="margin-bottom: 1rem; color: #dc2626;">
                    <i class="fas fa-chart-bar"></i> Performance Metrics
                </h3>
                <canvas id="driverPerformanceChart" style="max-height: 300px;"></canvas>
            </div>
        </div>
    </div>
</div>

</body>
</html>
</html>